
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <title>Cape Crypto | API Documentation</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sa {
  color: #6c71c4;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/screen-42b91c93.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-953e3353.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-b12a2749.js"></script>

    <script>
      $(function() { setupCodeCopy(); });
    </script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-b97fa499.png" class="logo" alt="" />
      <div class="subtitle">API Documentation V3.0.1</div>

        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#getting-started" class="toc-h1 toc-link" data-title="Getting started">Getting started</a>
          </li>
          <li>
            <a href="#authentication" class="toc-h1 toc-link" data-title="Authentication">Authentication</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#acting-on-behalf-of-sub-accounts-or-customers" class="toc-h2 toc-link" data-title="Acting on Behalf of Sub-Accounts or Customers">Acting on Behalf of Sub-Accounts or Customers</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#example-using-authentication" class="toc-h1 toc-link" data-title="Example using Authentication">Example using Authentication</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#post-create-order" class="toc-h2 toc-link" data-title="POST Create order"><span class="request-type__post">POST</span> Create order</a>
                  </li>
                  <li>
                    <a href="#post-create-order-as-sub-account" class="toc-h2 toc-link" data-title="POST Create order as sub-account"><span class="request-type__post">POST</span> Create order as sub-account</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#public-request-example" class="toc-h1 toc-link" data-title="Public request example">Public request example</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-get-available-markets" class="toc-h2 toc-link" data-title="GET Get available markets"><span class="request-type__get">GET</span> Get available markets</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#public" class="toc-h1 toc-link" data-title="Public">Public</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-alive" class="toc-h2 toc-link" data-title="GET Alive"><span class="request-type__get">GET</span> Alive</a>
                  </li>
                  <li>
                    <a href="#get-get-vasps" class="toc-h2 toc-link" data-title="GET Get VASPs"><span class="request-type__get">GET</span> Get VASPs</a>
                  </li>
                  <li>
                    <a href="#get-ticker" class="toc-h2 toc-link" data-title="GET Ticker"><span class="request-type__get">GET</span> Ticker</a>
                  </li>
                  <li>
                    <a href="#get-all-tickers" class="toc-h2 toc-link" data-title="GET All tickers"><span class="request-type__get">GET</span> All tickers</a>
                  </li>
                  <li>
                    <a href="#get-k-line" class="toc-h2 toc-link" data-title="GET K Line"><span class="request-type__get">GET</span> K Line</a>
                  </li>
                  <li>
                    <a href="#get-orderbook" class="toc-h2 toc-link" data-title="GET Orderbook"><span class="request-type__get">GET</span> Orderbook</a>
                  </li>
                  <li>
                    <a href="#get-market-trades" class="toc-h2 toc-link" data-title="GET Market trades"><span class="request-type__get">GET</span> Market trades</a>
                  </li>
                  <li>
                    <a href="#get-markets" class="toc-h2 toc-link" data-title="GET Markets"><span class="request-type__get">GET</span> Markets</a>
                  </li>
                  <li>
                    <a href="#get-all-currencies" class="toc-h2 toc-link" data-title="GET All Currencies"><span class="request-type__get">GET</span> All Currencies</a>
                  </li>
                  <li>
                    <a href="#get-single-currency" class="toc-h2 toc-link" data-title="GET Single Currency"><span class="request-type__get">GET</span> Single Currency</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#account" class="toc-h1 toc-link" data-title="Account">Account</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-get-transaction-history" class="toc-h2 toc-link" data-title="GET Get transaction history"><span class="request-type__get">GET</span> Get transaction history</a>
                  </li>
                  <li>
                    <a href="#post-create-new-beneficiary" class="toc-h2 toc-link" data-title="POST Create new beneficiary"><span class="request-type__post">POST</span> Create new beneficiary</a>
                  </li>
                  <li>
                    <a href="#patch-activate-beneficiary" class="toc-h2 toc-link" data-title="PATCH Activate beneficiary"><span class="request-type__patch">PATCH</span> Activate beneficiary</a>
                  </li>
                  <li>
                    <a href="#delete-delete-beneficiary" class="toc-h2 toc-link" data-title="DELETE Delete beneficiary"><span class="request-type__delete">DELETE</span> Delete beneficiary</a>
                  </li>
                  <li>
                    <a href="#get-beneficiary-by-id" class="toc-h2 toc-link" data-title="GET Beneficiary by id"><span class="request-type__get">GET</span> Beneficiary by id</a>
                  </li>
                  <li>
                    <a href="#get-list-beneficiaries" class="toc-h2 toc-link" data-title="GET List Beneficiaries"><span class="request-type__get">GET</span> List Beneficiaries</a>
                  </li>
                  <li>
                    <a href="#get-withdraw-quote" class="toc-h2 toc-link" data-title="GET Withdraw quote"><span class="request-type__post">GET</span> Withdraw quote</a>
                  </li>
                  <li>
                    <a href="#post-new-withdrawal" class="toc-h2 toc-link" data-title="POST New withdrawal"><span class="request-type__post">POST</span> New withdrawal</a>
                  </li>
                  <li>
                    <a href="#get-withdrawal-history" class="toc-h2 toc-link" data-title="GET Withdrawal history"><span class="request-type__post">GET</span> Withdrawal history</a>
                  </li>
                  <li>
                    <a href="#get-get-deposit-methods" class="toc-h2 toc-link" data-title="GET Get deposit methods"><span class="request-type__get">GET</span> Get deposit methods</a>
                  </li>
                  <li>
                    <a href="#get-get-withdraw-methods" class="toc-h2 toc-link" data-title="GET Get withdraw methods"><span class="request-type__get">GET</span> Get withdraw methods</a>
                  </li>
                  <li>
                    <a href="#post-redeem-voucher" class="toc-h2 toc-link" data-title="POST Redeem voucher"><span class="request-type__post">POST</span> Redeem voucher</a>
                  </li>
                  <li>
                    <a href="#get-deposit-address" class="toc-h2 toc-link" data-title="GET Deposit address"><span class="request-type__get">GET</span> Deposit address</a>
                  </li>
                  <li>
                    <a href="#get-deposit-by-id" class="toc-h2 toc-link" data-title="GET Deposit by ID"><span class="request-type__get">GET</span> Deposit by ID</a>
                  </li>
                  <li>
                    <a href="#post-submit-deposit-travel-rule" class="toc-h2 toc-link" data-title="POST Submit deposit travel rule"><span class="request-type__post">POST</span> Submit deposit travel rule</a>
                  </li>
                  <li>
                    <a href="#get-deposit-history" class="toc-h2 toc-link" data-title="GET Deposit history"><span class="request-type__get">GET</span> Deposit history</a>
                  </li>
                  <li>
                    <a href="#get-balance" class="toc-h2 toc-link" data-title="GET Balance"><span class="request-type__get">GET</span> Balance</a>
                  </li>
                  <li>
                    <a href="#get-all-balances" class="toc-h2 toc-link" data-title="GET All balances"><span class="request-type__get">GET</span> All balances</a>
                  </li>
                  <li>
                    <a href="#post-new-lightning-payment" class="toc-h2 toc-link" data-title="POST New lightning payment"><span class="request-type__post">POST</span> New lightning payment</a>
                  </li>
                  <li>
                    <a href="#post-create-a-lightning-invoice" class="toc-h2 toc-link" data-title="POST Create a Lightning invoice"><span class="request-type__post">POST</span> Create a Lightning invoice</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#sub-accounts" class="toc-h1 toc-link" data-title="Sub-Accounts">Sub-Accounts</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#post-create-sub-account" class="toc-h2 toc-link" data-title="POST Create Sub-Account"><span class="request-type__post">POST</span> Create Sub-Account</a>
                  </li>
                  <li>
                    <a href="#get-list-sub-accounts" class="toc-h2 toc-link" data-title="GET List Sub-Accounts"><span class="request-type__get">GET</span> List Sub-Accounts</a>
                  </li>
                  <li>
                    <a href="#get-get-sub-account-by-uid" class="toc-h2 toc-link" data-title="GET Get Sub-Account by UID"><span class="request-type__get">GET</span> Get Sub-Account by UID</a>
                  </li>
                  <li>
                    <a href="#put-update-sub-account" class="toc-h2 toc-link" data-title="PUT Update Sub-Account"><span class="request-type__put">PUT</span> Update Sub-Account</a>
                  </li>
                  <li>
                    <a href="#delete-delete-sub-account" class="toc-h2 toc-link" data-title="DELETE Delete Sub-Account"><span class="request-type__delete">DELETE</span> Delete Sub-Account</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#customers-management" class="toc-h1 toc-link" data-title="Customers Management">Customers Management</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#post-create-individual-customer" class="toc-h2 toc-link" data-title="POST Create Individual Customer"><span class="request-type__post">POST</span> Create Individual Customer</a>
                  </li>
                  <li>
                    <a href="#post-create-business-customer" class="toc-h2 toc-link" data-title="POST Create Business Customer"><span class="request-type__post">POST</span> Create Business Customer</a>
                  </li>
                  <li>
                    <a href="#get-list-customers" class="toc-h2 toc-link" data-title="GET List Customers"><span class="request-type__get">GET</span> List Customers</a>
                  </li>
                  <li>
                    <a href="#get-get-customer-by-uid" class="toc-h2 toc-link" data-title="GET Get Customer by UID"><span class="request-type__get">GET</span> Get Customer by UID</a>
                  </li>
                  <li>
                    <a href="#put-update-customer" class="toc-h2 toc-link" data-title="PUT Update Customer"><span class="request-type__put">PUT</span> Update Customer</a>
                  </li>
                  <li>
                    <a href="#post-upload-individual-customer-documents" class="toc-h2 toc-link" data-title="POST Upload Individual Customer Documents"><span class="request-type__post">POST</span> Upload Individual Customer Documents</a>
                  </li>
                  <li>
                    <a href="#post-upload-business-customer-documents" class="toc-h2 toc-link" data-title="POST Upload Business Customer Documents"><span class="request-type__post">POST</span> Upload Business Customer Documents</a>
                  </li>
                  <li>
                    <a href="#post-upload-ubo-documents" class="toc-h2 toc-link" data-title="POST Upload UBO Documents"><span class="request-type__post">POST</span> Upload UBO Documents</a>
                  </li>
                  <li>
                    <a href="#post-create-payment-reference" class="toc-h2 toc-link" data-title="POST Create payment reference"><span class="request-type__post">POST</span> Create payment reference</a>
                  </li>
                  <li>
                    <a href="#get-list-payment-references" class="toc-h2 toc-link" data-title="GET List payment references"><span class="request-type__get">GET</span> List payment references</a>
                  </li>
                  <li>
                    <a href="#get-get-payment-reference-by-id" class="toc-h2 toc-link" data-title="GET Get payment reference by id"><span class="request-type__get">GET</span> Get payment reference by id</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#merchant-management-aggregators-only" class="toc-h1 toc-link" data-title="Merchant Management (Aggregators Only)">Merchant Management (Aggregators Only)</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-list-merchants" class="toc-h2 toc-link" data-title="GET List Merchants"><span class="request-type__get">GET</span> List Merchants</a>
                  </li>
                  <li>
                    <a href="#get-list-merchant-39-s-customers" class="toc-h2 toc-link" data-title="GET List Merchant's Customers"><span class="request-type__get">GET</span> List Merchant's Customers</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#trading" class="toc-h1 toc-link" data-title="Trading">Trading</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#post-create-order-2" class="toc-h2 toc-link" data-title="POST Create Order"><span class="request-type__post">POST</span> Create Order</a>
                  </li>
                  <li>
                    <a href="#get-order-by-id" class="toc-h2 toc-link" data-title="GET Order by id"><span class="request-type__get">GET</span> Order by id</a>
                  </li>
                  <li>
                    <a href="#get-all-orders" class="toc-h2 toc-link" data-title="GET All orders"><span class="request-type__post">GET</span> All orders</a>
                  </li>
                  <li>
                    <a href="#get-trades" class="toc-h2 toc-link" data-title="GET Trades"><span class="request-type__get">GET</span> Trades</a>
                  </li>
                  <li>
                    <a href="#post-cancel-order" class="toc-h2 toc-link" data-title="POST Cancel Order"><span class="request-type__post">POST</span> Cancel Order</a>
                  </li>
                  <li>
                    <a href="#post-cancel-all-orders" class="toc-h2 toc-link" data-title="POST Cancel All Orders"><span class="request-type__post">POST</span> Cancel All Orders</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#websocket" class="toc-h1 toc-link" data-title="Websocket">Websocket</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#subscribe-orderbook" class="toc-h2 toc-link" data-title="SUBSCRIBE Orderbook"><span class="request-type__get">SUBSCRIBE</span> Orderbook</a>
                  </li>
                  <li>
                    <a href="#subscribe-k-line" class="toc-h2 toc-link" data-title="SUBSCRIBE K-Line"><span class="request-type__get">SUBSCRIBE</span> K-Line</a>
                  </li>
                  <li>
                    <a href="#subscribe-private" class="toc-h2 toc-link" data-title="SUBSCRIBE Private"><span class="request-type__get">SUBSCRIBE</span> Private</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#models" class="toc-h1 toc-link" data-title="Models">Models</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#pagination" class="toc-h2 toc-link" data-title="Pagination">Pagination</a>
                  </li>
                  <li>
                    <a href="#ticker" class="toc-h2 toc-link" data-title="Ticker">Ticker</a>
                  </li>
                  <li>
                    <a href="#tickerentry" class="toc-h2 toc-link" data-title="TickerEntry">TickerEntry</a>
                  </li>
                  <li>
                    <a href="#orderbook-entry" class="toc-h2 toc-link" data-title="Orderbook entry">Orderbook entry</a>
                  </li>
                  <li>
                    <a href="#trade" class="toc-h2 toc-link" data-title="Trade">Trade</a>
                  </li>
                  <li>
                    <a href="#order" class="toc-h2 toc-link" data-title="Order">Order</a>
                  </li>
                  <li>
                    <a href="#market" class="toc-h2 toc-link" data-title="Market">Market</a>
                  </li>
                  <li>
                    <a href="#currency" class="toc-h2 toc-link" data-title="Currency">Currency</a>
                  </li>
                  <li>
                    <a href="#withdraw" class="toc-h2 toc-link" data-title="Withdraw">Withdraw</a>
                  </li>
                  <li>
                    <a href="#withdraw-quote" class="toc-h2 toc-link" data-title="Withdraw quote">Withdraw quote</a>
                  </li>
                  <li>
                    <a href="#beneficiary" class="toc-h2 toc-link" data-title="Beneficiary">Beneficiary</a>
                  </li>
                  <li>
                    <a href="#subaccount" class="toc-h2 toc-link" data-title="SubAccount">SubAccount</a>
                  </li>
                  <li>
                    <a href="#customer" class="toc-h2 toc-link" data-title="Customer">Customer</a>
                  </li>
                  <li>
                    <a href="#customer-individual" class="toc-h2 toc-link" data-title="Customer (Individual)">Customer (Individual)</a>
                  </li>
                  <li>
                    <a href="#customer-business" class="toc-h2 toc-link" data-title="Customer (Business)">Customer (Business)</a>
                  </li>
                  <li>
                    <a href="#deposit" class="toc-h2 toc-link" data-title="Deposit">Deposit</a>
                  </li>
                  <li>
                    <a href="#transaction" class="toc-h2 toc-link" data-title="Transaction">Transaction</a>
                  </li>
                  <li>
                    <a href="#vasp" class="toc-h2 toc-link" data-title="VASP">VASP</a>
                  </li>
                  <li>
                    <a href="#paymentreference" class="toc-h2 toc-link" data-title="PaymentReference">PaymentReference</a>
                  </li>
                  <li>
                    <a href="#account-2" class="toc-h2 toc-link" data-title="Account">Account</a>
                  </li>
                  <li>
                    <a href="#deposit-method" class="toc-h2 toc-link" data-title="Deposit Method">Deposit Method</a>
                  </li>
                  <li>
                    <a href="#withdraw-method" class="toc-h2 toc-link" data-title="Withdraw Method">Withdraw Method</a>
                  </li>
                  <li>
                    <a href="#remaining-limits" class="toc-h2 toc-link" data-title="Remaining Limits">Remaining Limits</a>
                  </li>
                  <li>
                    <a href="#voucher-redemption" class="toc-h2 toc-link" data-title="Voucher Redemption">Voucher Redemption</a>
                  </li>
                  <li>
                    <a href="#change-voucher" class="toc-h2 toc-link" data-title="Change voucher">Change voucher</a>
                  </li>
                  <li>
                    <a href="#lightning-payment" class="toc-h2 toc-link" data-title="Lightning payment">Lightning payment</a>
                  </li>
                  <li>
                    <a href="#lightning-invoice" class="toc-h2 toc-link" data-title="Lightning invoice">Lightning invoice</a>
                  </li>
                  <li>
                    <a href="#websocket-orderbook-snapshot" class="toc-h2 toc-link" data-title="Websocket orderbook snapshot">Websocket orderbook snapshot</a>
                  </li>
                  <li>
                    <a href="#websocket-orderbook-increment" class="toc-h2 toc-link" data-title="Websocket orderbook increment">Websocket orderbook increment</a>
                  </li>
                  <li>
                    <a href="#states" class="toc-h2 toc-link" data-title="States">States</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#errors" class="toc-h1 toc-link" data-title="Errors">Errors</a>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href="https://trade.capecrypto.com" target="_blank">Cape Crypto PTY LTD</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>Welcome to the Cape Crypto API Documentation. You can use our full API suite to integrate with us.</p>

<p>Create and cancel orders, view your account balance, stream orderbook and account updates over websocket, and perform all other actions you can perform from the apps.</p>

<p>ðŸš€ Looking for trading features that we haven&#39;t added yet? We&#39;ll add them for you! <a href="https://support.capecrypto.com/hc/en-us/requests/new" target="_blank">Reach out to us</a></p>

<p><img src="https://raw.githubusercontent.com/capecrypto/kungfu/main/hummingbot_icon.jpg" alt="Hummingbot icon" title="Hummingbot icon" width="15" height="15"/> Looking for a Hummingbot connector for Cape Crypto? We have one! <a href="https://support.capecrypto.com/hc/en-us/requests/new" target="_blank">Reach out to us</a></p>
<h1 id='getting-started'>Getting started</h1>
<p>The API suite consists of public and private endpoints. Private endpoints require your requests to be signed for authentication. In order to sign your requests, you will need to create and API key and secret, and have 2FA enabled:</p>

<ol>
<li>Sign into your account <a href="https://trade.capecrypto.com" target="_blank">Cape Crypto</a></li>
<li>Head to the <strong>Profile</strong> page by clicking the profile icon at the top right</li>
<li>Enable 2FA</li>
<li>Create a new API key</li>
<li>Save your new API key and Secret and do not share it with anyone</li>
</ol>

<p>Use your API key and secret to sign your requests for all private endpoints. (Public endpoints do not require authentication)</p>

<p>All requests unless otherwise noted (EG for sub-account / customer management) use the following base URLs:</p>

<ul>
<li>Base url REST: <code>https://trade.capecrypto.com/api/v2/atlas</code></li>
<li>Base url Websocket: <code>wss://trade.capecrypto.com/api/v2/websocket</code></li>
</ul>

<p>For Sub-account and customer management (noted in the routes below):</p>

<ul>
<li>Base url: <code>https://trade.capecrypto.com/api/v2/persona</code></li>
<li>Base url: <code>https://trade.capecrypto.com/api/v2/verification</code></li>
</ul>
<h1 id='authentication'>Authentication</h1>
<blockquote>
<p>Authentication:</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// generateHeaders.js</span>

<span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">apiKey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">123456...</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">ABCDEF...</span><span class="dl">"</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">subAccountUid</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">timeStamp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">queryString</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">timeStamp</span><span class="p">}${</span><span class="nx">apikey</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">crypto</span>
    <span class="p">.</span><span class="nx">createHmac</span><span class="p">(</span><span class="dl">"</span><span class="s2">sha256</span><span class="dl">"</span><span class="p">,</span> <span class="nx">secret</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">queryString</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json;charset=utf-8</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Apikey</span><span class="dl">"</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Nonce</span><span class="dl">"</span><span class="p">:</span> <span class="nx">timeStamp</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Signature</span><span class="dl">"</span><span class="p">:</span> <span class="nx">signature</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Signature</span><span class="dl">"</span><span class="p">:</span> <span class="nx">signature</span><span class="p">,</span>
    <span class="c1">// Only for sub-account / customer requests:</span>
    <span class="dl">"</span><span class="s2">X-Auth-Subaccount-UID</span><span class="dl">"</span><span class="p">:</span> <span class="nx">subAccountUid</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">};</span>
</code></pre></div>
<aside class="notice">
Ensure you have <strong>Enabled 2FA</strong> and <strong>Created your API key</strong>.
</aside>

<p>To securely access the private endpoints, each request requires authentication headers.</p>

<p>Generate a new signature for each new request, and add these headers to the request.</p>

<ol>
<li><strong>X-Auth-Nonce</strong>: Current timestamp in milliseconds UTC time.</li>
<li><strong>X-Auth-Apikey</strong>: Your API key</li>
<li><strong>X-Auth-Signature</strong>: HMAC-SHA256 encrypted string of the combined timestamp, apikey and secret (see JS example)</li>
</ol>
<h2 id='acting-on-behalf-of-sub-accounts-or-customers'>Acting on Behalf of Sub-Accounts or Customers</h2>
<p>When making requests on behalf of a sub-account or customer, include an additional optional header:</p>

<ol>
<li><strong>X-Auth-Subaccount-Uid</strong>: The UID of the sub-account or customer you want to act as</li>
</ol>

<p>This allows the parent account (or merchant/aggregator) to make authenticated requests as if they were the sub-account or customer. The regular authentication headers (API key, nonce, signature) must still be included.</p>
<h1 id='example-using-authentication'>Example using Authentication</h1><h2 id='post-create-order'><span class="request-type__post">POST</span> Create order</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// generateHeaders.js</span>

<span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">apiKey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">123456...</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">ABCDEF...</span><span class="dl">"</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">timeStamp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">queryString</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">timeStamp</span><span class="p">}${</span><span class="nx">apikey</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">crypto</span>
    <span class="p">.</span><span class="nx">createHmac</span><span class="p">(</span><span class="dl">"</span><span class="s2">sha256</span><span class="dl">"</span><span class="p">,</span> <span class="nx">secret</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">queryString</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json;charset=utf-8</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Apikey</span><span class="dl">"</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Nonce</span><span class="dl">"</span><span class="p">:</span> <span class="nx">timeStamp</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Signature</span><span class="dl">"</span><span class="p">:</span> <span class="nx">signature</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">};</span>
</code></pre></div>
<blockquote>
<p>Send the authenticated request:</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// createOrder.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">createOrder</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/atlas/market/orders`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">orderData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">market</span><span class="p">:</span> <span class="dl">"</span><span class="s2">btczar</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">side</span><span class="p">:</span> <span class="dl">"</span><span class="s2">sell</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">volume</span><span class="p">:</span> <span class="dl">"</span><span class="s2">0.00001</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">ord_type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">limit</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">price</span><span class="p">:</span> <span class="dl">"</span><span class="s2">800000</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">post_only</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">custom_order_id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">302b0494-1a06-4089-846c-0c6b13f1b661</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">orderData</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<blockquote>
<p>Create order response:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">173757</span><span class="p">,</span><span class="w">
  </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7e86a4fa-fcae-4953-b9bc-d6f328beea48"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"side"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sell"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"ord_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"limit"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="s2">"800000.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"avg_price"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pending"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"market"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btczar"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2023-12-08T08:46:59+01:00"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2023-12-08T08:46:59+01:00"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"origin_volume"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.00001"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"remaining_volume"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.00001"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"executed_volume"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"trades_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"custom_order_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"302b0494-1a06-4089-846c-0c6b13f1b661"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><code>https://trade.capecrypto.com/api/v2/atlas/market/orders</code></p>

<p>Create a new order on your account by signing your request and submitting the request</p>
<h2 id='post-create-order-as-sub-account'><span class="request-type__post">POST</span> Create order as sub-account</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// generateHeadersWithSubAccount.js</span>

<span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">apiKey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">123456...</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">ABCDEF...</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">subAccountUid</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">ID123456789ABC</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Sub-account or customer UID</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">timeStamp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">queryString</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">timeStamp</span><span class="p">}${</span><span class="nx">apiKey</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">crypto</span>
    <span class="p">.</span><span class="nx">createHmac</span><span class="p">(</span><span class="dl">"</span><span class="s2">sha256</span><span class="dl">"</span><span class="p">,</span> <span class="nx">secret</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">queryString</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json;charset=utf-8</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Apikey</span><span class="dl">"</span><span class="p">:</span> <span class="nx">apiKey</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Nonce</span><span class="dl">"</span><span class="p">:</span> <span class="nx">timeStamp</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Signature</span><span class="dl">"</span><span class="p">:</span> <span class="nx">signature</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Subaccount-Uid</span><span class="dl">"</span><span class="p">:</span> <span class="nx">subAccountUid</span><span class="p">,</span> <span class="c1">// Act on behalf of sub-account/customer</span>
  <span class="p">};</span>
<span class="p">};</span>
</code></pre></div>
<blockquote>
<p>Send the authenticated request as sub-account:</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// createOrderAsSubAccount.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeadersWithSubAccount</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">createOrder</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/atlas/market/orders`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">orderData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">market</span><span class="p">:</span> <span class="dl">"</span><span class="s2">btczar</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">side</span><span class="p">:</span> <span class="dl">"</span><span class="s2">buy</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">volume</span><span class="p">:</span> <span class="dl">"</span><span class="s2">0.00001</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">ord_type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">limit</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">price</span><span class="p">:</span> <span class="dl">"</span><span class="s2">750000</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">orderData</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p><code>https://trade.capecrypto.com/api/v2/atlas/market/orders</code></p>

<p>When the <code>X-Auth-Subaccount-Uid</code> header is included, the order is created on behalf of the specified sub-account or customer. The parent account&#39;s API credentials are used for authentication, but the operation is performed in the context of the sub-account.</p>
<h1 id='public-request-example'>Public request example</h1><h2 id='get-get-available-markets'><span class="request-type__get">GET</span> Get available markets</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">getMarkets</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/atlas/public/markets`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">getMarkets</span><span class="p">();</span>
</code></pre></div>
<blockquote>
<p>Markets response:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btczar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTC/ZAR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"base_unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btc"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"quote_unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"min_price"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200000.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"max_price"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1200000.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"min_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.00001"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"amount_precision"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
    </span><span class="nl">"price_precision"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enabled"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ethzar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ETH/ZAR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"base_unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eth"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"quote_unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"min_price"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10000.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"max_price"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100000.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"min_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0001"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"amount_precision"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
    </span><span class="nl">"price_precision"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enabled"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xrpzar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XRP/ZAR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"base_unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xrp"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"quote_unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"min_price"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"max_price"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"min_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"amount_precision"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
    </span><span class="nl">"price_precision"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enabled"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usdczar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USDC/ZAR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"base_unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usdc"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"quote_unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"min_price"</span><span class="p">:</span><span class="w"> </span><span class="s2">"14.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"max_price"</span><span class="p">:</span><span class="w"> </span><span class="s2">"29.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"min_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.5"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"amount_precision"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"price_precision"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enabled"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><code>GET https://trade.capecrypto.com/api/v2/atlas/public/markets</code></p>

<p>Returns a list of all available markets</p>
<h1 id='public'>Public</h1><h2 id='get-alive'><span class="request-type__get">GET</span> Alive</h2>
<p><code>/public/health/alive</code></p>
<h3 id='description'>Description</h3>
<p>Check that the trade engine is running. Occasionally the trade engine will be temporarily taken offline for udpates and general maintenance. Maintenence will usually not take longer than a few minutes.</p>
<h3 id='responses'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Trade engine is running, trading is available</td>
</tr>
</tbody></table>
<h2 id='get-get-vasps'><span class="request-type__get">GET</span> Get VASPs</h2>
<p><code>/public/vasps</code></p>
<h3 id='description-2'>Description</h3>
<p>Retrieve a paginated list of active Virtual Asset Service Providers (VASPs) registered in the system. VASPs are used for travel rule compliance when creating beneficiaries with cryptocurrency addresses.</p>

<p>When creating a beneficiary with travel rule information, use the <code>id</code> from this endpoint as the <code>vasp_id</code> in the beneficiary data.</p>
<h3 id='parameters'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>page</td>
<td>query</td>
<td>Page number (default: 1)</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>limit</td>
<td>query</td>
<td>Results per page (default: 25, max: 100)</td>
<td>No</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='response-headers'>Response Headers</h3>
<table><thead>
<tr>
<th>Header</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Page</td>
<td>Current page number</td>
</tr>
<tr>
<td>Per-Page</td>
<td>Number of results per page</td>
</tr>
<tr>
<td>Total</td>
<td>Total number of VASPs available</td>
</tr>
</tbody></table>
<h3 id='responses-2'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>List of active VASPs</td>
<td>[ <a href="#vasp">VASP</a> ]</td>
</tr>
</tbody></table>
<h2 id='get-ticker'><span class="request-type__get">GET</span> Ticker</h2>
<p><code>/public/markets/{market}/tickers</code></p>
<h3 id='description-3'>Description</h3>
<p>Get ticker of specific market.</p>
<h3 id='parameters-2'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>market</td>
<td>path</td>
<td></td>
<td>Yes</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-3'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200 Returns a ticker.</td>
<td><a href="#ticker">Ticker</a></td>
<td></td>
</tr>
</tbody></table>
<h2 id='get-all-tickers'><span class="request-type__get">GET</span> All tickers</h2>
<p><code>/public/markets/tickers</code></p>
<h3 id='description-4'>Description</h3>
<p>Get ticker of all markets</p>
<h3 id='responses-4'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Returns an array of tickers.</td>
<td><a href="#ticker">Ticker</a></td>
</tr>
</tbody></table>
<h2 id='get-k-line'><span class="request-type__get">GET</span> K Line</h2>
<p><code>/public/markets/{market}/k-line</code></p>
<h3 id='description-5'>Description</h3>
<p>Get K-Line (OHLC) of specific market.</p>
<h3 id='parameters-3'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>market</td>
<td>path</td>
<td></td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>period</td>
<td>query</td>
<td>Time period of K line, default to 1. You can choose between 1, 5, 15, 30, 60, 120, 240, 360, 720, 1440, 4320, 10080</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>time_from</td>
<td>query</td>
<td>Timestamp in ms. If set, only k-line data after that time will be returned.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>time_to</td>
<td>query</td>
<td>Timestamp in ms. If set, only k-line data till that time will be returned.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>limit</td>
<td>query</td>
<td>Limit the number of returned data points default to 30. Ignored if time_from and time_to are given.</td>
<td>No</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='responses-5'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Returns K-Line (OHLC) of market.</td>
</tr>
</tbody></table>
<h2 id='get-orderbook'><span class="request-type__get">GET</span> Orderbook</h2>
<p><code>/public/markets/{market}/depth</code></p>
<h3 id='description-6'>Description</h3>
<p>Get the orderbook for the specified market eg. &#39;btczar&#39;. Asks and bids are sorted away from the spread, ie asks are sorted low to high, and bids are sorted high to low. Results are returned in tupples of [price, amount] in the base currency eg. &#39;btc&#39;.</p>
<h3 id='parameters-4'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>market</td>
<td>path</td>
<td></td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>limit</td>
<td>query</td>
<td>Limit the number of returned price levels. Default 100.</td>
<td>No</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='responses-6'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Get orderbook of specified market</td>
</tr>
</tbody></table>
<h2 id='get-market-trades'><span class="request-type__get">GET</span> Market trades</h2>
<p><code>/public/markets/{market}/trades</code></p>
<h3 id='description-7'>Description</h3>
<p>Get recent trades for the specified market, results are paginated</p>
<h3 id='parameters-5'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>market</td>
<td>path</td>
<td></td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>limit</td>
<td>query</td>
<td>Limit the number of returned trades. Default to 100.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>time_from</td>
<td>query</td>
<td>Timestamp in ms. Return trades executed after the timestamp.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>time_to</td>
<td>query</td>
<td>Timestamp in ms. Return trades executed before the timestamp.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>page</td>
<td>query</td>
<td>Paginated page number.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>order_by</td>
<td>query</td>
<td>Default is desc (newest to oldest). Options are [asc desc]</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-7'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Get recent trades on market.</td>
<td>[ <a href="#trade">Trade</a> ]</td>
</tr>
</tbody></table>
<h2 id='get-markets'><span class="request-type__get">GET</span> Markets</h2>
<p><code>/public/markets</code></p>
<h3 id='description-8'>Description</h3>
<p>Get all available markets.</p>
<h3 id='parameters-6'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>limit</td>
<td>query</td>
<td>Limit the number of returned paginations. Defaults to 100.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>page</td>
<td>query</td>
<td>Paginated page number.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>ordering</td>
<td>query</td>
<td>Order of results by field name (see order_by below), defaults to &#39;asc&#39;.</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>order_by</td>
<td>query</td>
<td>Name of the field to order by. [id position]</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>base_unit</td>
<td>query</td>
<td>Return only markets that have this currency as the base unit eg. &#39;btc&#39;</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>quote_unit</td>
<td>query</td>
<td>Return only markets that have this currency as the quote unit eg. &#39;zar&#39;</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-8'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Get all available markets.</td>
<td>[ <a href="#market">Market</a> ]</td>
</tr>
</tbody></table>
<h2 id='get-all-currencies'><span class="request-type__get">GET</span> All Currencies</h2>
<p><code>/public/currencies</code></p>
<h3 id='description-9'>Description</h3>
<p>Get list of currencies</p>
<h3 id='parameters-7'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>limit</td>
<td>query</td>
<td>Limit the number of returned paginations. Defaults to 100.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>page</td>
<td>query</td>
<td>Paginated page number.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>type</td>
<td>query</td>
<td>Currency type</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-9'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Get list of currencies</td>
<td>[ <a href="#currency">Currency</a> ]</td>
</tr>
</tbody></table>
<h2 id='get-single-currency'><span class="request-type__get">GET</span> Single Currency</h2>
<p><code>/public/currencies/{id}</code></p>
<h3 id='description-10'>Description</h3>
<p>Get a single currency</p>
<h3 id='parameters-8'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>path</td>
<td>Currency code.</td>
<td>Yes</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-10'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Get a currency</td>
<td><a href="#currency">Currency</a></td>
</tr>
</tbody></table>
<h1 id='account'>Account</h1><h2 id='get-get-transaction-history'><span class="request-type__get">GET</span> Get transaction history</h2>
<p><code>/account/transactions</code></p>
<h3 id='description-11'>Description</h3>
<p>Retrieve your complete transaction history with flexible filtering options. This endpoint returns all types of transactions including deposits, withdrawals, trades, internal transfers, referrals, and maker rewards.</p>

<p>Transactions can be filtered by currency (matches both credit and debit currencies), transaction type, time range, and specific transaction ID. Results are paginated and can be ordered by creation time.</p>
<h3 id='parameters-9'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>currency</td>
<td>query</td>
<td>Filter by currency code (matches credit or debit currency, e.g., &quot;btc&quot;, &quot;zar&quot;)</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>type</td>
<td>query</td>
<td>Filter by transaction type: &#39;deposit&#39;, &#39;withdraw&#39;, &#39;internal_transfer&#39;, &#39;trade&#39;, &#39;referral&#39;, &#39;maker_reward&#39;</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>txid</td>
<td>query</td>
<td>Filter by specific transaction ID</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>time_from</td>
<td>query</td>
<td>Start timestamp (Unix timestamp in seconds)</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>time_to</td>
<td>query</td>
<td>End timestamp (Unix timestamp in seconds)</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>order_by</td>
<td>query</td>
<td>Sort order: &#39;asc&#39; or &#39;desc&#39; (default: &#39;desc&#39;)</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>page</td>
<td>query</td>
<td>Page number (default: 1, min: 1)</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>limit</td>
<td>query</td>
<td>Results per page (default: 50, min: 1, max: 1000)</td>
<td>No</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='response-headers-2'>Response Headers</h3>
<table><thead>
<tr>
<th>Header</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Total</td>
<td>Total number of transactions</td>
</tr>
<tr>
<td>Page</td>
<td>Current page number</td>
</tr>
<tr>
<td>Per-Page</td>
<td>Number of results per page</td>
</tr>
</tbody></table>
<h3 id='responses-11'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Transaction history retrieved</td>
<td>[ <a href="#transaction">Transaction</a> ]</td>
</tr>
<tr>
<td>401</td>
<td>Authentication required</td>
<td>Error array</td>
</tr>
<tr>
<td>422</td>
<td>Validation error</td>
<td>Error array</td>
</tr>
</tbody></table>
<h3 id='example-request'>Example Request</h3><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">getTransactions</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/account/transactions?currency=btc&amp;type=deposit&amp;limit=25&amp;page=1`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">getTransactions</span><span class="p">();</span>
</code></pre></div><h2 id='post-create-new-beneficiary'><span class="request-type__post">POST</span> Create new beneficiary</h2>
<p><code>/account/beneficiaries</code></p>
<h3 id='description-12'>Description</h3>
<p>Create a new beneficiary for cryptocurrency or fiat withdrawals. Beneficiaries can be cryptocurrency wallet addresses (with required travel rule information) or bank accounts for fiat transfers. All beneficiaries created via the API are automatically activated and ready for use.</p>

<p>For cryptocurrency beneficiaries with travel rule requirements, you can specify whether the wallet is your own (<code>is_own</code>), unhosted (<code>is_unhosted</code>), or associated with a Virtual Asset Service Provider (VASP). Use the <a href="#get-get-vasps">Get VASPs</a> endpoint to retrieve available VASP IDs.</p>
<h3 id='parameters-10'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
<th>Max Length</th>
</tr>
</thead><tbody>
<tr>
<td>currency</td>
<td>formData</td>
<td>Currency code (e.g., &quot;btc&quot;, &quot;eth&quot;, &quot;zar&quot;, &quot;gbp&quot;)</td>
<td>Yes</td>
<td>string</td>
<td>10 chars</td>
</tr>
<tr>
<td>name</td>
<td>formData</td>
<td>Display name for the beneficiary</td>
<td>Yes</td>
<td>string</td>
<td>64 chars</td>
</tr>
<tr>
<td>description</td>
<td>formData</td>
<td>Optional notes about the beneficiary</td>
<td>No</td>
<td>string</td>
<td>255 chars</td>
</tr>
<tr>
<td>blockchain_key</td>
<td>formData</td>
<td>Blockchain identifier (defaults to currency&#39;s blockchain if omitted)</td>
<td>No</td>
<td>string</td>
<td>255 chars</td>
</tr>
<tr>
<td>withdraw_method_id</td>
<td>formData</td>
<td>Specific withdrawal method ID (auto-selected if omitted)</td>
<td>No</td>
<td>integer</td>
<td>-</td>
</tr>
<tr>
<td>data</td>
<td>formData</td>
<td>Address/account details in JSON format (structure varies by currency type - see tables below)</td>
<td>Yes</td>
<td>json</td>
<td>-</td>
</tr>
</tbody></table>

<p>Cryptocurrency <code>data</code> Object Fields</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>address</td>
<td>string</td>
<td>Yes</td>
<td>Cryptocurrency wallet address</td>
</tr>
<tr>
<td>tag</td>
<td>string</td>
<td>No</td>
<td>Destination tag (for XRP, Stellar, etc.) - max: 4294967295</td>
</tr>
<tr>
<td>is_own</td>
<td>boolean</td>
<td>No</td>
<td>Travel rule: Is this your own wallet?</td>
</tr>
<tr>
<td>is_unhosted</td>
<td>boolean</td>
<td>No</td>
<td>Travel rule: Is this an unhosted wallet?</td>
</tr>
<tr>
<td>vasp_id</td>
<td>number</td>
<td>No</td>
<td>Travel rule: VASP ID (obtain from <a href="#get-get-vasps">Get VASPs</a> endpoint)</td>
</tr>
<tr>
<td>recipient_data</td>
<td>object</td>
<td>No</td>
<td>Travel rule: Recipient information (see travel rule fields)</td>
</tr>
</tbody></table>

<p>Fiat <code>data</code> Object Fields</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>full_name</td>
<td>string</td>
<td><strong>Yes</strong></td>
<td>Account holder&#39;s full legal name (mandatory for fiat)</td>
</tr>
<tr>
<td>account_number</td>
<td>string</td>
<td>No</td>
<td>Bank account number</td>
</tr>
<tr>
<td>bank_name</td>
<td>string</td>
<td>No</td>
<td>Name of the bank</td>
</tr>
<tr>
<td>bank_swift_code</td>
<td>string</td>
<td>No</td>
<td>SWIFT/BIC code</td>
</tr>
<tr>
<td>bank_routing_number</td>
<td>string</td>
<td>No</td>
<td>Routing number (US banks)</td>
</tr>
<tr>
<td>iban</td>
<td>string</td>
<td>No</td>
<td>IBAN (International Bank Account Number)</td>
</tr>
<tr>
<td>bank_address</td>
<td>string</td>
<td>No</td>
<td>Bank&#39;s physical address</td>
</tr>
<tr>
<td>bank_city</td>
<td>string</td>
<td>No</td>
<td>Bank&#39;s city</td>
</tr>
<tr>
<td>intermediary_bank_swift</td>
<td>string</td>
<td>No</td>
<td>Intermediary bank SWIFT code (for international transfers)</td>
</tr>
<tr>
<td>account_holder_name</td>
<td>string</td>
<td>No</td>
<td>Account holder name (may differ from full_name)</td>
</tr>
<tr>
<td>account_type</td>
<td>string</td>
<td>No</td>
<td>Type of account (checking, savings, etc.)</td>
</tr>
</tbody></table>

<p>Travel Rule <code>recipient_data</code> Object (Nested within <code>data</code>) (required for Cryptocurrency Beneficiaries)</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>first_name</td>
<td>string</td>
<td>Yes (for Individuals)</td>
<td>Recipient&#39;s first name</td>
</tr>
<tr>
<td>last_name</td>
<td>string</td>
<td>Yes (for Individuals)</td>
<td>Recipient&#39;s last name</td>
</tr>
<tr>
<td>country</td>
<td>string</td>
<td>Yes</td>
<td>Recipient&#39;s country code</td>
</tr>
<tr>
<td>identity_type</td>
<td>string</td>
<td>Yes</td>
<td>Individual or Business</td>
</tr>
<tr>
<td>company_name</td>
<td>string</td>
<td>Yes (for Businesses)</td>
<td>Company name (for business recipients)</td>
</tr>
</tbody></table>
<h3 id='request-examples'>Request Examples</h3>
<p><strong>Example 1: Crypto - Bitcoin</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btc"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My Bitcoin Wallet"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Personal cold storage wallet"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bc1qar0srrr7xfkvy5l643lydnw9re59gtzzwf5mdq"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Example 2: Crypto - XRP with Destination Tag</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xrp"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Exchange XRP Account"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My Binance XRP deposit"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rN7n7otQDd6FczFgLdlqtyMVrn3qHwuSaDcqC"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"tag"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123456789"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Example 3: Crypto - Ethereum with Travel Rule Info</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eth"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Friend's Wallet"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John's Ethereum wallet"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"is_own"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"is_unhosted"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"recipient_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Example 4: Fiat - ZAR (South African Rand)</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zar"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"South African Bank Account"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Personal savings account"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"full_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Thabo Mbeki"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1234567890"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bank_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Standard Bank"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bank_swift_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SBZAZAJJ"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bank_address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"30 Baker Street"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bank_city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Johannesburg"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"account_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"savings"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Example 5: Fiat - GBP SWIFT Transfer</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gbp"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UK Business Account"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Company bank account"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"full_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John Smith"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345678"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bank_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Barclays Bank"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bank_swift_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BARCGB22"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bank_address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1 Churchill Place"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bank_city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"London"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"account_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"checking"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Example 6: Fiat - EUR IBAN Transfer</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eur"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EU Partner Account"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"European supplier payment"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"full_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Jean Dupont"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"iban"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FR1420041010050500013M02606"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bank_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BNP Paribas"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bank_swift_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BNPAFRPP"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bank_city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Paris"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Example 7: Fiat - International with Intermediary Bank</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usd"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"International Vendor"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Asian supplier USD payment"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"full_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ABC Trading Company Ltd"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9876543210"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bank_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Asia Commercial Bank"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bank_swift_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ACBVSGSG"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"intermediary_bank_swift"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CHASUS33"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bank_address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123 Business Street"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bank_city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Singapore"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='important-notes'>Important Notes</h3>
<ul>
<li><strong>API-created beneficiaries</strong> are automatically activated (state = <code>active</code>) and do not require PIN activation</li>
<li><strong>Fiat beneficiaries</strong> must include <code>full_name</code> in the <code>data</code> object (mandatory)</li>
<li><strong>Cryptocurrency addresses</strong> are validated against the blockchain service before creation</li>
<li><strong>XRP destination tags</strong> must be unsigned int32 (maximum: 4294967295)</li>
<li><strong>Duplicate addresses</strong> are not allowed for the same currency/blockchain combination</li>
</ul>
<h3 id='responses-12'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>201</td>
<td>Create new beneficiary</td>
<td><a href="#beneficiary">Beneficiary</a></td>
</tr>
</tbody></table>
<h2 id='patch-activate-beneficiary'><span class="request-type__patch">PATCH</span> Activate beneficiary</h2>
<p><code>/account/beneficiaries/{id}/activate</code></p>
<h3 id='description-13'>Description</h3>
<p>Activates a new beneficiary with pin emailed during beneficiary creation.</p>

<p><strong>Note:</strong> This activation step is only required for beneficiaries created through the web interface. Beneficiaries created via the API are automatically activated and do not require this step.</p>
<h3 id='parameters-11'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>path</td>
<td>Beneficiary Identifier</td>
<td>Yes</td>
<td>integer</td>
</tr>
<tr>
<td>pin</td>
<td>formData</td>
<td>Pin code for beneficiary activation</td>
<td>Yes</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='responses-13'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Activates beneficiary with pin</td>
<td><a href="#beneficiary">Beneficiary</a></td>
</tr>
</tbody></table>
<h2 id='delete-delete-beneficiary'><span class="request-type__delete">DELETE</span> Delete beneficiary</h2>
<p><code>/account/beneficiaries/{id}</code></p>
<h3 id='description-14'>Description</h3>
<p>Delete beneficiary</p>
<h3 id='parameters-12'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>path</td>
<td>Beneficiary Identifier</td>
<td>Yes</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='responses-14'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>204</td>
<td>Delete beneficiary</td>
</tr>
</tbody></table>
<h2 id='get-beneficiary-by-id'><span class="request-type__get">GET</span> Beneficiary by id</h2>
<p><code>/account/beneficiaries/{id}</code></p>
<h3 id='description-15'>Description</h3>
<p>Get beneficiary by id</p>
<h3 id='parameters-13'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>path</td>
<td>Beneficiary Identifier</td>
<td>Yes</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='responses-15'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Get beneficiary by id</td>
<td><a href="#beneficiary">Beneficiary</a></td>
</tr>
</tbody></table>
<h2 id='get-list-beneficiaries'><span class="request-type__get">GET</span> List Beneficiaries</h2>
<p><code>/account/beneficiaries</code></p>
<h3 id='description-16'>Description</h3>
<p>Get list of user beneficiaries</p>
<h3 id='parameters-14'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>currency</td>
<td>query</td>
<td>Beneficiary currency code.</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>state</td>
<td>query</td>
<td>Defines either beneficiary active - user can use it to withdraw moneyor pending - requires beneficiary activation with pin.</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-16'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Get list of user beneficiaries</td>
<td>[ <a href="#beneficiary">Beneficiary</a> ]</td>
</tr>
</tbody></table>
<h2 id='get-withdraw-quote'><span class="request-type__post">GET</span> Withdraw quote</h2>
<p><code>/account/withdraws/quote/{currency}</code></p>

<p><code>/account/withdraws/quote/{currency}?bolt=ln...</code></p>
<h3 id='description-17'>Description</h3>
<p>Get the expected fee to withdraw the specified currency. Submit the quote_id with your withdraw request payload to honor that fee during the withdrawal. Quotes are currently valid for 90 seconds, ensure you submit the withdrawal request before the expires_at parameter.</p>
<h3 id='parameters-15'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>currency</td>
<td>path</td>
<td>Currency code.</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>bolt</td>
<td>query</td>
<td>For BTC Lightning payments, supply the Bolt11 invoice. Fees are returned in BTC.</td>
<td>No</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='responses-17'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Returns a withdraw quote</td>
<td>[ <a href="#withdraw-quote">Withdraw quote</a> ]</td>
</tr>
<tr>
<td>422</td>
<td>Unproccesable entity</td>
<td>Error array containing the reason why the quote could not be created</td>
</tr>
</tbody></table>
<h2 id='post-new-withdrawal'><span class="request-type__post">POST</span> New withdrawal</h2>
<p><code>/account/withdraws</code></p>
<h3 id='description-18'>Description</h3>
<p>Creates new withdrawal to active beneficiary.</p>

<p><strong>Note:</strong> OTP is <strong>not required</strong> when creating withdrawals via the API. The OTP requirement only applies to withdrawals created through the web interface.</p>
<h3 id='parameters-16'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>otp</td>
<td>formData</td>
<td>OTP to perform action (not required for API requests)</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>beneficiary_id</td>
<td>formData</td>
<td>ID of active Beneficiary.</td>
<td>Yes</td>
<td>integer</td>
</tr>
<tr>
<td>currency</td>
<td>formData</td>
<td>The currency code matching the beneficiary.</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>amount</td>
<td>formData</td>
<td>The amount to withdraw.</td>
<td>Yes</td>
<td>double</td>
</tr>
<tr>
<td>note</td>
<td>formData</td>
<td>ZAR withdrawals only. Use &#39;same_day_rtc&#39; for <a href="https://support.capecrypto.com/hc/en-za/articles/360015121638-Fee-schedule#zar-withdraw-fees">Faster withdraws</a></td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-18'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>201</td>
<td>Creates new withdrawal.</td>
</tr>
</tbody></table>
<h2 id='get-withdrawal-history'><span class="request-type__post">GET</span> Withdrawal history</h2>
<p><code>/account/withdraws</code></p>
<h3 id='description-19'>Description</h3>
<p>Get your withdraw history, paginated.</p>
<h3 id='parameters-17'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>currency</td>
<td>query</td>
<td>Currency code.</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>limit</td>
<td>query</td>
<td>Number of withdraws per page (defaults to 100, maximum is 100).</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>state</td>
<td>query</td>
<td>Filter by withdraw state. [ <a href="#states">Withdraw states</a> ]</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>rid</td>
<td>query</td>
<td>Destination address (blockchain withdraws only).</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>page</td>
<td>query</td>
<td>Page number (defaults to 1).</td>
<td>No</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='responses-19'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>List your withdraws.</td>
<td>[ <a href="#withdraw">Withdraw</a> ]</td>
</tr>
</tbody></table>
<h2 id='get-get-deposit-methods'><span class="request-type__get">GET</span> Get deposit methods</h2>
<p><code>/api/v2/payments/deposits/methods</code></p>
<h3 id='description-20'>Description</h3>
<p>Get all available deposit methods for the authenticated user. Returns deposit methods for both cryptocurrencies and fiat currencies, filtered based on the user&#39;s KYC level and remaining transaction limits.</p>

<p>Each method includes minimum and maximum amounts, fees, provider information, and remaining limits for different time periods (daily, weekly, monthly, yearly).</p>
<h3 id='responses-20'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Array of available deposit methods.</td>
<td>[ <a href="#deposit-method">Deposit Method</a> ]</td>
</tr>
</tbody></table>
<h2 id='get-get-withdraw-methods'><span class="request-type__get">GET</span> Get withdraw methods</h2>
<p><code>/api/v2/payments/withdraws/methods</code></p>
<h3 id='description-21'>Description</h3>
<p>Get all available withdrawal methods for the authenticated user. Returns withdrawal methods for both cryptocurrencies and fiat currencies, filtered based on the user&#39;s KYC level and remaining transaction limits.</p>

<p>Each method includes minimum and maximum amounts, fees, provider information, processor details, and remaining limits for different time periods (daily, weekly, monthly, yearly).</p>
<h3 id='responses-21'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Array of available withdrawal methods.</td>
<td>[ <a href="#withdraw-method">Withdraw Method</a> ]</td>
</tr>
</tbody></table>
<h2 id='post-redeem-voucher'><span class="request-type__post">POST</span> Redeem voucher</h2>
<p><code>/payments/vouchers/new</code></p>
<h3 id='description-22'>Description</h3>
<p>Redeem a voucher code.</p>
<h3 id='parameters-18'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>payment_method_id</td>
<td>query</td>
<td>The id of this deposit method (see Instant FIAT deposit methods)</td>
<td>Yes</td>
<td>integer</td>
</tr>
<tr>
<td>amount</td>
<td>query</td>
<td>The amount to redeem, eg 10 redeems R10</td>
<td>Yes</td>
<td>double</td>
</tr>
<tr>
<td>voucher_pin</td>
<td>query</td>
<td>The voucher redemption code.</td>
<td>Yes</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-22'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>201</td>
<td>Voucher redemption.</td>
<td><a href="#voucher-redemption">Voucher redemption</a></td>
</tr>
</tbody></table>
<h2 id='get-deposit-address'><span class="request-type__get">GET</span> Deposit address</h2>
<p><code>/account/deposit_address/{currency}</code></p>
<h3 id='description-23'>Description</h3>
<p>Fetch the deposit address for the specified currency.</p>

<p>Note: If your currency deposit address has not been created yet, the result may return empty while the address is being created. If it is empty, please try again in a few seconds.</p>
<h3 id='parameters-19'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>currency</td>
<td>path</td>
<td>The currency to receive.</td>
<td>Yes</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-23'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Deposit address. (May be empty on first request for new accounts, see note above).</td>
<td><a href="#deposit">Deposit</a></td>
</tr>
</tbody></table>
<h2 id='get-deposit-by-id'><span class="request-type__get">GET</span> Deposit by ID</h2>
<p><code>/account/deposits/{id}</code></p>
<h3 id='description-24'>Description</h3>
<p>Get details of a specific deposit by its internal deposit ID.</p>
<h3 id='parameters-20'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>path</td>
<td>Deposit ID</td>
<td>Yes</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='responses-24'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Get details of specific deposit.</td>
<td><a href="#deposit">Deposit</a></td>
</tr>
</tbody></table>
<h2 id='post-submit-deposit-travel-rule'><span class="request-type__post">POST</span> Submit deposit travel rule</h2>
<p><code>/account/deposits/{id}/travel_rule</code></p>
<h3 id='description-25'>Description</h3>
<p>Submit travel rule compliance information for a cryptocurrency deposit that is on hold pending travel rule verification.</p>

<p><strong>Note:</strong> This endpoint is only applicable for cryptocurrency deposits in the <code>on_hold_travel_rule_customer</code> state. The deposit must be a coin deposit (not fiat).</p>
<h3 id='parameters-21'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>path</td>
<td>Deposit ID</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>is_own</td>
<td>formData</td>
<td>Is this your own wallet?</td>
<td>Yes</td>
<td>boolean</td>
</tr>
<tr>
<td>is_unhosted</td>
<td>formData</td>
<td>Is this an unhosted wallet? (Cannot be true if vasp_id is provided)</td>
<td>Yes</td>
<td>boolean</td>
</tr>
<tr>
<td>vasp_id</td>
<td>formData</td>
<td>VASP ID from the system (mutually exclusive with custom_vasp fields)</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>custom_vasp_name</td>
<td>formData</td>
<td>Custom VASP name (required if not using vasp_id and not unhosted)</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>custom_vasp_url</td>
<td>formData</td>
<td>Custom VASP URL (required if not using vasp_id and not unhosted)</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>originator_data</td>
<td>formData</td>
<td>Originator information in JSON format (required if is_own is false, see fields below)</td>
<td>No</td>
<td>json</td>
</tr>
</tbody></table>

<p><strong>Originator Data Fields:</strong></p>

<p>When <code>is_own</code> is <code>false</code>, you must provide originator information:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>identity_type</td>
<td>string</td>
<td>Yes</td>
<td>Type of identity (e.g., &quot;passport&quot;, &quot;id&quot;)</td>
</tr>
<tr>
<td>first_name</td>
<td>string</td>
<td>Yes (for Individuals)</td>
<td>Originator&#39;s first name</td>
</tr>
<tr>
<td>last_name</td>
<td>string</td>
<td>Yes (for Individuals)</td>
<td>Originator&#39;s last name</td>
</tr>
<tr>
<td>company_name</td>
<td>string</td>
<td>Yes (for Businesses)</td>
<td>Company name (for business originators)</td>
</tr>
<tr>
<td>country</td>
<td>string</td>
<td>Yes</td>
<td>ISO country code (e.g., &quot;US&quot;, &quot;ZA&quot;, &quot;GB&quot;)</td>
</tr>
</tbody></table>
<h3 id='responses-25'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Travel rule submitted successfully. Deposit transitions to hold state.</td>
<td><a href="#deposit">Deposit</a></td>
</tr>
<tr>
<td>422</td>
<td>Validation error or deposit not eligible (wrong state, already submitted).</td>
<td>Error array</td>
</tr>
</tbody></table>
<h2 id='get-deposit-history'><span class="request-type__get">GET</span> Deposit history</h2>
<p><code>/account/deposits</code></p>
<h3 id='description-26'>Description</h3>
<p>Get your deposit history. You can filter by specific deposit transaction using the <code>txid</code> query parameter, or fetch all deposits with optional filters for currency and state</p>
<h3 id='parameters-22'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>currency</td>
<td>query</td>
<td>Currency code</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>state</td>
<td>query</td>
<td>Filter deposits by deposit state <a href="#states">States</a></td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>txid</td>
<td>query</td>
<td>Deposit transaction id.</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>limit</td>
<td>query</td>
<td>Number of deposits per page (defaults to 100, maximum is 100).</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>page</td>
<td>query</td>
<td>Page number (defaults to 1).</td>
<td>No</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='responses-26'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Get your deposit history.</td>
<td>[ <a href="#deposit">Deposit</a> ]</td>
</tr>
</tbody></table>
<h2 id='get-balance'><span class="request-type__get">GET</span> Balance</h2>
<p><code>/account/balances/{currency}</code></p>
<h3 id='description-27'>Description</h3>
<p>Get single account balance by currency code eg. &#39;btc&#39;</p>
<h3 id='parameters-23'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>currency</td>
<td>path</td>
<td>The currency code.</td>
<td>Yes</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-27'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Get account balance by currency</td>
<td><a href="#account">Account</a></td>
</tr>
</tbody></table>
<h2 id='get-all-balances'><span class="request-type__get">GET</span> All balances</h2>
<p><code>/account/balances</code></p>
<h3 id='description-28'>Description</h3>
<p>Get account balances for all currencies</p>
<h3 id='parameters-24'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>limit</td>
<td>query</td>
<td>Limit the number of returned paginations. Defaults to 100.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>page</td>
<td>query</td>
<td>Paginated page number.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>nonzero</td>
<td>query</td>
<td>Filter non zero balances.</td>
<td>No</td>
<td>Boolean</td>
</tr>
</tbody></table>
<h3 id='responses-28'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Array of balances</td>
<td>[ <a href="#account">Account</a> ]</td>
</tr>
</tbody></table>
<h2 id='post-new-lightning-payment'><span class="request-type__post">POST</span> New lightning payment</h2>
<p><code>/account/lightning/pays</code></p>
<h3 id='description-29'>Description</h3>
<p>Submits a payment request to pay a BTC Lightning BOLT11 invoice (withdraws this balance from your BTC account).</p>

<p>As the payment is requested and validated on the lightning network, please query your withdrawal history to confirm that the payment succeeded.</p>
<h3 id='parameters-25'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>bolt</td>
<td>query</td>
<td>The bolt11 invoice to pay (either bolt or address required)</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>address</td>
<td>query</td>
<td>Lightning address (alternative to bolt)</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>amount</td>
<td>query</td>
<td>The amount to of the invoice in SATs. Sanity check is performed against the supplied bolt11</td>
<td>Yes</td>
<td>double</td>
</tr>
<tr>
<td>quote_id</td>
<td>query</td>
<td>The quote_id of the withdrawal quote, see <a href="#get-withdraw-quote">Withdraw quote</a></td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>member_description</td>
<td>query</td>
<td>Personal description of this payment for your records</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>description</td>
<td>query</td>
<td>Payment description (visible to recipient if applicable)</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>otp</td>
<td>query</td>
<td>6-digit OTP code (required for web session, not required for API sessions)</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>data</td>
<td>formData</td>
<td>Travel rule information in JSON format (see travel rule fields below)</td>
<td>No</td>
<td>json</td>
</tr>
</tbody></table>

<p><strong>Travel Rule Data (Optional):</strong></p>

<p>For compliance with travel rule requirements, you can include recipient information in the <code>data</code> parameter as a JSON object:</p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"is_own"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"is_unhosted"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"vasp_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
  </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lnbc..."</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Lightning</span><span class="w"> </span><span class="err">address</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">BOLT</span><span class="mi">11</span><span class="w">
  </span><span class="nl">"recipient_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"company_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Acme Corp"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123 Main St"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"identity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Passport"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Travel Rule Fields:</strong></p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>is_own</td>
<td>boolean</td>
<td>Is this your own wallet?</td>
</tr>
<tr>
<td>is_unhosted</td>
<td>boolean</td>
<td>Is this an unhosted wallet?</td>
</tr>
<tr>
<td>vasp_id</td>
<td>number</td>
<td>VASP ID (obtain from <a href="#get-get-vasps">Get VASPs</a> endpoint)</td>
</tr>
<tr>
<td>address</td>
<td>string</td>
<td>Lightning address or BOLT11 invoice</td>
</tr>
<tr>
<td>recipient_data</td>
<td>object</td>
<td>Recipient information (see fields below)</td>
</tr>
</tbody></table>

<p><strong>Recipient Data Fields:</strong></p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>first_name</td>
<td>string</td>
<td>Recipient&#39;s first name</td>
</tr>
<tr>
<td>last_name</td>
<td>string</td>
<td>Recipient&#39;s last name</td>
</tr>
<tr>
<td>company_name</td>
<td>string</td>
<td>Company name (for business recipients)</td>
</tr>
<tr>
<td>address</td>
<td>string</td>
<td>Physical address</td>
</tr>
<tr>
<td>country</td>
<td>string</td>
<td>Country code (e.g., &quot;US&quot;, &quot;ZA&quot;)</td>
</tr>
<tr>
<td>identity_type</td>
<td>string</td>
<td>Type of identification document</td>
</tr>
</tbody></table>
<h3 id='responses-29'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>201</td>
<td>Lightning payment.</td>
<td>[ <a href="#lightning-payment">Lightning payment</a> ]</td>
</tr>
</tbody></table>
<h2 id='post-create-a-lightning-invoice'><span class="request-type__post">POST</span> Create a Lightning invoice</h2>
<p><code>/account/lightning/invoices</code></p>
<h3 id='description-30'>Description</h3>
<p>Create a new lightning invoice to be paid (receive) over the BTC Lightning network.</p>

<p>You can optionally specify a conversion_percent (1 = 100%, 0.1 = 10%) to automatically convert once the invoice is paid. The conversion percent should be such that the conversion amount is greater than or equal to the minimum order amount for the market eg. &#39;btczar&#39;. For example if receiving BTC 0.00001, and the minimum order amount on &#39;btczar&#39; is 0.00001, your conversion percent would have to be 1 (100%). Anything less would cause the invoice creation to fail, as the conversion amount would be below the minimum market order amount.</p>

<p>The invoice expires in 1 hour.</p>
<h3 id='parameters-26'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>amount</td>
<td>query</td>
<td>The amount to of the invoice in SATs. Sanity check is performed against the supplied bolt11</td>
<td>Yes</td>
<td>double</td>
</tr>
<tr>
<td>conversion_percent</td>
<td>query</td>
<td>Percent of the received amount to be automatically converted to FIAT</td>
<td>No</td>
<td>double</td>
</tr>
<tr>
<td>description</td>
<td>query</td>
<td>The description for the invoice (visible on the Bolt11 invoice to the payer). If left blank the default Cape Crypto Invoice is used</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>member_description</td>
<td>query</td>
<td>Personal description of this invoice for your records</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-30'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>201</td>
<td>Lightning invoice.</td>
<td>[ <a href="#lightning-invoice">Lightning invoice</a> ]</td>
</tr>
</tbody></table>
<h1 id='sub-accounts'>Sub-Accounts</h1>
<p><strong>Note:</strong> Sub-account endpoints use the <code>/api/v2/persona</code> base path instead of <code>/api/v2/atlas</code>.</p>

<p><strong>Sub-Account actions:</strong> To make API requests for a sub-account (e.g., placing trades, checking balances), include the <code>X-Auth-Subaccount-Uid</code> header with the sub-account&#39;s UID. Your parent account&#39;s API credentials are used for authentication, but operations are performed in the sub-account&#39;s context.</p>
<h2 id='post-create-sub-account'><span class="request-type__post">POST</span> Create Sub-Account</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// createSubAccount.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">createSubAccount</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/persona/resource/sub_accounts`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">subAccountData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">account_name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Trading Account 1</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">deposit_action</span><span class="p">:</span> <span class="dl">"</span><span class="s2">transfer_to_parent</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">subAccountData</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">createSubAccount</span><span class="p">();</span>
</code></pre></div>
<p><code>/persona/resource/sub_accounts</code></p>
<h3 id='description-31'>Description</h3>
<p>Create a new sub-account that inherits the parent&#39;s KYC verification. Sub-accounts cannot login independently and are managed by the parent account.</p>
<h3 id='parameters-27'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>account_name</td>
<td>formData</td>
<td>Display name for the sub-account (1-100 characters)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>deposit_action</td>
<td>formData</td>
<td>JSON object defining automated deposit handling (see deposit action options below)</td>
<td>No</td>
<td>json</td>
</tr>
<tr>
<td>data</td>
<td>formData</td>
<td>Optional additional data in JSON format</td>
<td>No</td>
<td>json</td>
</tr>
</tbody></table>

<p><strong>Deposit Action Options:</strong></p>

<p>Configure automatic actions for deposits received by this sub-account.</p>

<p>The <code>deposit_action</code> parameter accepts a JSON object with the following structure:</p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"none|aggregate|convert_and_withdraw|aggregate_convert_and_withdraw"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"target_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"currency_code"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Required</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">convert</span><span class="w"> </span><span class="err">actions</span><span class="w"> </span><span class="err">(e.g.</span><span class="p">,</span><span class="w"> </span><span class="s2">"zar"</span><span class="p">,</span><span class="w"> </span><span class="s2">"usd"</span><span class="err">)</span><span class="w">
  </span><span class="nl">"beneficiary_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Required</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">withdraw</span><span class="w"> </span><span class="err">actions</span><span class="w">
  </span><span class="nl">"lightning_invoice"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lnbc..."</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Alternative</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">beneficiary_id</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">Lightning</span><span class="w"> </span><span class="err">withdrawals</span><span class="w">
  </span><span class="nl">"max_slippage"</span><span class="p">:</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Optional:</span><span class="w"> </span><span class="err">Max</span><span class="w"> </span><span class="err">slippage</span><span class="w"> </span><span class="err">percentage</span><span class="w"> </span><span class="err">(</span><span class="mf">0.1</span><span class="mi">-10</span><span class="p">,</span><span class="w"> </span><span class="err">default:</span><span class="w"> </span><span class="mf">2.0</span><span class="err">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Available Actions:</strong></p>

<table><thead>
<tr>
<th>Action</th>
<th>Description</th>
<th>Required Fields</th>
</tr>
</thead><tbody>
<tr>
<td><code>none</code></td>
<td>No automatic action (default)</td>
<td>None</td>
</tr>
<tr>
<td><code>aggregate</code></td>
<td>Automatically transfer deposits to parent account</td>
<td>None</td>
</tr>
<tr>
<td><code>convert_and_withdraw</code></td>
<td>Convert deposit to target currency and withdraw to beneficiary</td>
<td><code>target_currency</code>, <code>beneficiary_id</code> or <code>lightning_invoice</code></td>
</tr>
<tr>
<td><code>aggregate_convert_and_withdraw</code></td>
<td>Transfer to parent, then convert and withdraw</td>
<td><code>target_currency</code>, <code>beneficiary_id</code> or <code>lightning_invoice</code></td>
</tr>
</tbody></table>

<p><strong>Example with Simple Aggregate:</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"account_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Trading Account 1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"deposit_action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aggregate"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Example with Convert and Withdraw:</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"account_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD Conversion Account"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"deposit_action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"convert_and_withdraw"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"target_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usd"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"beneficiary_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">789</span><span class="p">,</span><span class="w">
    </span><span class="nl">"max_slippage"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.5</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='responses-31'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>201</td>
<td>Sub-account created successfully</td>
<td><a href="#subaccount">SubAccount</a></td>
</tr>
<tr>
<td>422</td>
<td>Validation error</td>
<td>Error array</td>
</tr>
</tbody></table>
<h2 id='get-list-sub-accounts'><span class="request-type__get">GET</span> List Sub-Accounts</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// listSubAccounts.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">listSubAccounts</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/persona/resource/sub_accounts?page=1&amp;limit=100`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">listSubAccounts</span><span class="p">();</span>
</code></pre></div>
<p><code>/persona/resource/sub_accounts</code></p>
<h3 id='description-32'>Description</h3>
<p>Get a paginated list of the user&#39;s sub-accounts.</p>
<h3 id='parameters-28'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>page</td>
<td>query</td>
<td>Page number (defaults to 1)</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>limit</td>
<td>query</td>
<td>Number of results per page (default: 100, max: 1000)</td>
<td>No</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='responses-32'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>List of sub-accounts</td>
<td>[ <a href="#subaccount">SubAccount</a> ]</td>
</tr>
</tbody></table>
<h2 id='get-get-sub-account-by-uid'><span class="request-type__get">GET</span> Get Sub-Account by UID</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// getSubAccount.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">getSubAccount</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">subAccountUid</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">ID123456789ABC</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/persona/resource/sub_accounts/</span><span class="p">${</span><span class="nx">subAccountUid</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">getSubAccount</span><span class="p">();</span>
</code></pre></div>
<p><code>/persona/resource/sub_accounts/{uid}</code></p>
<h3 id='description-33'>Description</h3>
<p>Retrieve a specific sub-account by its unique identifier.</p>
<h3 id='parameters-29'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>uid</td>
<td>path</td>
<td>Sub-account identifier</td>
<td>Yes</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-33'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Sub-account found</td>
<td><a href="#subaccount">SubAccount</a></td>
</tr>
<tr>
<td>404</td>
<td>Not found</td>
<td>Error array</td>
</tr>
</tbody></table>
<h2 id='put-update-sub-account'><span class="request-type__put">PUT</span> Update Sub-Account</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// updateSubAccount.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">updateSubAccount</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">PUT</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">subAccountUid</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">ID123456789ABC</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/persona/resource/sub_accounts/</span><span class="p">${</span><span class="nx">subAccountUid</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">updateData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">deposit_action</span><span class="p">:</span> <span class="dl">"</span><span class="s2">none</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">updateData</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">updateSubAccount</span><span class="p">();</span>
</code></pre></div>
<p><code>/persona/resource/sub_accounts/{uid}</code></p>
<h3 id='description-34'>Description</h3>
<p>Update sub-account settings.</p>
<h3 id='parameters-30'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>uid</td>
<td>path</td>
<td>Sub-account identifier</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>deposit_action</td>
<td>formData</td>
<td>Action for deposits: &#39;none&#39; or &#39;transfer_to_parent&#39;</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-34'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Sub-account updated successfully</td>
<td><a href="#subaccount">SubAccount</a></td>
</tr>
<tr>
<td>404</td>
<td>Not found</td>
<td>Error array</td>
</tr>
<tr>
<td>422</td>
<td>Validation error</td>
<td>Error array</td>
</tr>
</tbody></table>
<h2 id='delete-delete-sub-account'><span class="request-type__delete">DELETE</span> Delete Sub-Account</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// deleteSubAccount.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">deleteSubAccount</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">DELETE</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">subAccountUid</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">ID123456789ABC</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/persona/resource/sub_accounts/</span><span class="p">${</span><span class="nx">subAccountUid</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Sub-account deleted successfully</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">deleteSubAccount</span><span class="p">();</span>
</code></pre></div>
<p><code>/persona/resource/sub_accounts/{uid}</code></p>
<h3 id='description-35'>Description</h3>
<p>Soft delete a sub-account (sets state to &#39;deleted&#39;). The sub-account will no longer be accessible.</p>
<h3 id='parameters-31'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>uid</td>
<td>path</td>
<td>Sub-account identifier</td>
<td>Yes</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-35'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>204</td>
<td>Sub-account deleted successfully</td>
</tr>
<tr>
<td>404</td>
<td>Not found</td>
</tr>
</tbody></table>
<h1 id='customers-management'>Customers Management</h1>
<p><strong>Note:</strong> Customer management endpoints use the <code>/api/v2/persona</code> base path and are available for <strong>Merchants</strong> and <strong>Aggregators</strong> only. Not all accounts are enabled for customer management, please contact us at support.capecrypto.com should you with to apply to upgrade your account to a merchant or aggregator account.</p>

<p><strong>Hierarchical Structure:</strong></p>

<ul>
<li><strong>Aggregators</strong> can create and manage both merchants (associated to them) and customers</li>
<li><strong>Merchants</strong> can create and manage customers under their own account</li>
</ul>

<p><strong>Customer Types:</strong></p>

<ul>
<li><strong>Individual customers</strong> - Personal accounts with profile information</li>
<li><strong>Business customers</strong> - Business accounts with company details and UBO information</li>
</ul>

<p><strong>Acting as a Customer:</strong> To make API requests for a customer (e.g., placing trades, checking balances, making withdrawals), include the <code>X-Auth-Subaccount-Uid</code> header with the customer&#39;s UID. Your merchant/aggregator API credentials are used for authentication, but operations are performed in the customer&#39;s context.</p>
<h2 id='post-create-individual-customer'><span class="request-type__post">POST</span> Create Individual Customer</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// createIndividualCustomer.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">createIndividualCustomer</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/persona/resource/customers`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">customerData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">entity_type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">individual</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">email</span><span class="p">:</span> <span class="dl">"</span><span class="s2">customer@example.com</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">phone_number</span><span class="p">:</span> <span class="dl">"</span><span class="s2">+27821234567</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">account_name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">John Doe Account</span><span class="dl">"</span><span class="p">,</span>

    <span class="c1">// Personal Information</span>
    <span class="na">first_name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">John</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">last_name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Doe</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">dob</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1990-01-15</span><span class="dl">"</span><span class="p">,</span>

    <span class="c1">// Location Information</span>
    <span class="na">address</span><span class="p">:</span> <span class="dl">"</span><span class="s2">123 Main Street, Apt 4B</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">postcode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">7700</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">city</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Cape Town</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">country</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ZA</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">nationality</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ZA</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">country_of_residence</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ZA</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">sa_id_number</span><span class="p">:</span> <span class="dl">"</span><span class="s2">9001155800087</span><span class="dl">"</span><span class="p">,</span>

    <span class="c1">// Professional Information (See not above for approved list)</span>
    <span class="na">occupation</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Software Engineer</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">source_of_funds</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Salary or Wages</span><span class="dl">"</span><span class="p">,</span>

    <span class="c1">// Document Information</span>
    <span class="na">doc_number</span><span class="p">:</span> <span class="dl">"</span><span class="s2">M12345678</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">doc_type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Passport</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">doc_expire</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2028-12-31</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">doc_country</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ZA</span><span class="dl">"</span><span class="p">,</span>

    <span class="c1">// PEP Declaration</span>
    <span class="na">is_pep_occupation</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">is_pep_related</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">is_pip</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">customerData</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">createIndividualCustomer</span><span class="p">();</span>
</code></pre></div>
<p><code>/persona/resource/customers</code></p>
<h3 id='description-36'>Description</h3>
<p>Create a new individual customer account. Merchants create customers under their own account. Aggregators can create customers under their own account or under a specific merchant by providing <code>merchant_uid</code>.</p>

<p><strong>Individual customers</strong> are automatically verified with Email, Phone, Profile, and Document labels after creation. Document files must be uploaded separately using the document upload endpoint (see &quot;Upload Individual Customer Documents&quot; section below).</p>

<hr>
<h3 id='parameters-32'>Parameters</h3>
<p><strong>Account Information:</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>entity_type</td>
<td>formData</td>
<td>Must be &#39;individual&#39;</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>email</td>
<td>formData</td>
<td>Customer email address (unique per merchant)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>phone_number</td>
<td>formData</td>
<td>Phone number in international format (e.g., +27821234567)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>account_name</td>
<td>formData</td>
<td>Display name for the account</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>merchant_uid</td>
<td>formData</td>
<td>Merchant UID (aggregators only - create under specific merchant)</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>first_name</td>
<td>formData</td>
<td>Customer first name</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>last_name</td>
<td>formData</td>
<td>Customer last name</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>dob</td>
<td>formData</td>
<td>Date of birth in YYYY-MM-DD format (must be 18+)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>address</td>
<td>formData</td>
<td>Full street address</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>postcode</td>
<td>formData</td>
<td>Postal/ZIP code</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>city</td>
<td>formData</td>
<td>City name</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>country</td>
<td>formData</td>
<td>ISO country code (2 chars, e.g., &#39;ZA&#39;, &#39;US&#39;)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>nationality</td>
<td>formData</td>
<td>Nationality ISO country code (2 chars)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>country_of_residence</td>
<td>formData</td>
<td>Country of residence ISO code (2 chars)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>sa_id_number</td>
<td>formData</td>
<td>South African ID number</td>
<td>Yes if nationality=&#39;ZA&#39;</td>
<td>string</td>
</tr>
<tr>
<td>occupation</td>
<td>formData</td>
<td>Customer occupation (e.g., &#39;Software Engineer&#39;, &#39;Teacher&#39;, &#39;Business Owner&#39;)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>source_of_funds</td>
<td>formData</td>
<td>Source of funds (e.g., &#39;Salary or Wages&#39;, &#39;Business Income&#39;, &#39;Investment Income&#39;)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>is_pep_occupation</td>
<td>formData</td>
<td>Is the customer a PEP by occupation? (default: false)</td>
<td>No</td>
<td>boolean</td>
</tr>
<tr>
<td>pep_occupation_data</td>
<td>formData</td>
<td>Details if is_pep_occupation is true</td>
<td>Yes if is_pep_occupation=true</td>
<td>string</td>
</tr>
<tr>
<td>is_pep_related</td>
<td>formData</td>
<td>Is the customer related to a PEP? (default: false)</td>
<td>No</td>
<td>boolean</td>
</tr>
<tr>
<td>pep_related_data</td>
<td>formData</td>
<td>Details if is_pep_related is true</td>
<td>Yes if is_pep_related=true</td>
<td>string</td>
</tr>
<tr>
<td>is_pip</td>
<td>formData</td>
<td>Is the customer a Prominent Influential Person? (default: false)</td>
<td>No</td>
<td>boolean</td>
</tr>
<tr>
<td>pip_data</td>
<td>formData</td>
<td>Details if is_pip is true</td>
<td>Yes if is_pip=true</td>
<td>string</td>
</tr>
<tr>
<td>deposit_action</td>
<td>formData</td>
<td>JSON object defining automated deposit handling (see deposit action options below)</td>
<td>No</td>
<td>json</td>
</tr>
</tbody></table>

<p><strong>Deposit Action Options:</strong></p>

<p>The <code>deposit_action</code> parameter accepts a JSON object with the following structure:</p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"none|aggregate|convert_and_withdraw|aggregate_convert_and_withdraw"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"target_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"currency_code"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Required</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">convert</span><span class="w"> </span><span class="err">actions</span><span class="w"> </span><span class="err">(e.g.</span><span class="p">,</span><span class="w"> </span><span class="s2">"zar"</span><span class="p">,</span><span class="w"> </span><span class="s2">"usd"</span><span class="err">)</span><span class="w">
  </span><span class="nl">"beneficiary_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Required</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">withdraw</span><span class="w"> </span><span class="err">actions</span><span class="w">
  </span><span class="nl">"lightning_invoice"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lnbc..."</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Alternative</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">beneficiary_id</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">Lightning</span><span class="w"> </span><span class="err">withdrawals</span><span class="w">
  </span><span class="nl">"max_slippage"</span><span class="p">:</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Optional:</span><span class="w"> </span><span class="err">Max</span><span class="w"> </span><span class="err">slippage</span><span class="w"> </span><span class="err">percentage</span><span class="w"> </span><span class="err">(</span><span class="mf">0.1</span><span class="mi">-10</span><span class="p">,</span><span class="w"> </span><span class="err">default:</span><span class="w"> </span><span class="mf">2.0</span><span class="err">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Available Actions:</strong></p>

<table><thead>
<tr>
<th>Action</th>
<th>Description</th>
<th>Required Fields</th>
</tr>
</thead><tbody>
<tr>
<td><code>none</code></td>
<td>No automatic action (default)</td>
<td>None</td>
</tr>
<tr>
<td><code>aggregate</code></td>
<td>Automatically transfer deposits to parent merchant/aggregator account</td>
<td>None</td>
</tr>
<tr>
<td><code>convert_and_withdraw</code></td>
<td>Convert deposit to target currency and withdraw to beneficiary</td>
<td><code>target_currency</code>, <code>beneficiary_id</code> or <code>lightning_invoice</code></td>
</tr>
<tr>
<td><code>aggregate_convert_and_withdraw</code></td>
<td>Transfer to parent, then convert and withdraw</td>
<td><code>target_currency</code>, <code>beneficiary_id</code> or <code>lightning_invoice</code></td>
</tr>
</tbody></table>

<p><strong>Example with Deposit Action:</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"entity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"individual"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"customer@example.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="p">,</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="err">other</span><span class="w"> </span><span class="err">required</span><span class="w"> </span><span class="err">fields</span><span class="w"> </span><span class="err">...</span><span class="w">
  </span><span class="nl">"deposit_action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"convert_and_withdraw"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"target_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"beneficiary_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span><span class="p">,</span><span class="w">
    </span><span class="nl">"max_slippage"</span><span class="p">:</span><span class="w"> </span><span class="mf">2.5</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='responses-36'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>201</td>
<td>Customer created successfully</td>
<td><a href="#customer">Customer</a></td>
</tr>
<tr>
<td>422</td>
<td>Validation error</td>
<td>Error array</td>
</tr>
</tbody></table>
<h2 id='post-create-business-customer'><span class="request-type__post">POST</span> Create Business Customer</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// createBusinessCustomer.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">createBusinessCustomer</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/persona/resource/customers`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">customerData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">entity_type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">business</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">email</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin@acmecorp.com</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">phone_number</span><span class="p">:</span> <span class="dl">"</span><span class="s2">+27821234567</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">account_name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ACME Corporation</span><span class="dl">"</span><span class="p">,</span>

    <span class="na">business_profile</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// Core Business Information</span>
      <span class="na">company_name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ACME Corp (Pty) Ltd</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">registration_number</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2020/123456/07</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">registration_country</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ZA</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">industry</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Financial Services</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">purpose_of_account</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Cryptocurrency trading and payment processing</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">expected_monthly_volume_usd</span><span class="p">:</span> <span class="mi">500000</span><span class="p">,</span>

      <span class="c1">// Additional Business Information</span>
      <span class="na">jurisdictions_of_operation</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">ZA</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">US</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GB</span><span class="dl">"</span><span class="p">],</span>
      <span class="na">website</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://www.acmecorp.com</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">employee_count</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>

      <span class="c1">// Business Address</span>
      <span class="na">address</span><span class="p">:</span> <span class="dl">"</span><span class="s2">123 Business Street, Suite 100</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">city</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Cape Town</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">postcode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">8001</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">country</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ZA</span><span class="dl">"</span><span class="p">,</span>

      <span class="c1">// License Information</span>
      <span class="na">license_status</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Licensed</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">license_number</span><span class="p">:</span> <span class="dl">"</span><span class="s2">FSP12345</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">license_jurisdictions</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">ZA</span><span class="dl">"</span><span class="p">],</span>
    <span class="p">},</span>

    <span class="c1">// Ultimate Beneficial Owners (at least 1 required)</span>
    <span class="na">ubos</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="c1">// Personal Information</span>
        <span class="na">email</span><span class="p">:</span> <span class="dl">"</span><span class="s2">jane.smith@acmecorp.com</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">first_name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Jane</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">last_name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Smith</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">phone_number</span><span class="p">:</span> <span class="dl">"</span><span class="s2">+27821111111</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">dob</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1985-05-15</span><span class="dl">"</span><span class="p">,</span>

        <span class="c1">// Residence Information</span>
        <span class="na">address</span><span class="p">:</span> <span class="dl">"</span><span class="s2">456 Residential Ave</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">postcode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">7700</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">city</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Cape Town</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">country</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ZA</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">nationality</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ZA</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">id_number</span><span class="p">:</span> <span class="dl">"</span><span class="s2">8505155800088</span><span class="dl">"</span><span class="p">,</span>

        <span class="c1">// Professional Information</span>
        <span class="na">occupation</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Chief Executive Officer</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">source_of_funds</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Business Income</span><span class="dl">"</span><span class="p">,</span>

        <span class="c1">// Ownership &amp; Roles</span>
        <span class="na">ownership_percentage</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
        <span class="na">is_director</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">is_authorized_signatory</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>

        <span class="c1">// PEP Declaration</span>
        <span class="na">is_pep_occupation</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">is_pep_related</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">is_pip</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="c1">// Second UBO example</span>
        <span class="na">email</span><span class="p">:</span> <span class="dl">"</span><span class="s2">john.doe@acmecorp.com</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">first_name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">John</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">last_name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Doe</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">dob</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1980-03-20</span><span class="dl">"</span><span class="p">,</span>

        <span class="na">address</span><span class="p">:</span> <span class="dl">"</span><span class="s2">789 Co-founder Street</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">postcode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">7800</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">city</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Cape Town</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">country</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ZA</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">nationality</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ZA</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">id_number</span><span class="p">:</span> <span class="dl">"</span><span class="s2">8003205800089</span><span class="dl">"</span><span class="p">,</span>

        <span class="na">occupation</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Chief Technology Officer</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">source_of_funds</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Business Income</span><span class="dl">"</span><span class="p">,</span>

        <span class="na">ownership_percentage</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
        <span class="na">is_director</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">is_authorized_signatory</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>

        <span class="na">is_pep_occupation</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">is_pep_related</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">is_pip</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">],</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">customerData</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">createBusinessCustomer</span><span class="p">();</span>
</code></pre></div>
<p><code>/persona/resource/customers</code></p>
<h3 id='description-37'>Description</h3>
<p>Create a new business customer account with company details and Ultimate Beneficial Owner (UBO) information. Merchants create customers under their own account. Aggregators can create customers under their own account or under a specific merchant by providing <code>merchant_uid</code>.</p>

<p><strong>Business customers</strong> start with &#39;pending&#39; status and require verification. Business documents must be uploaded separately using the document upload endpoint (see &quot;Upload Business Customer Documents&quot; section below).</p>

<hr>
<h3 id='parameters-33'>Parameters</h3>
<p><strong>Account Information:</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>entity_type</td>
<td>formData</td>
<td>Must be &#39;business&#39;</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>email</td>
<td>formData</td>
<td>Business email address (unique per merchant)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>phone_number</td>
<td>formData</td>
<td>Business phone number in international format</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>account_name</td>
<td>formData</td>
<td>Business account display name (typically company name)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>merchant_uid</td>
<td>formData</td>
<td>Merchant UID (aggregators only - create under specific merchant)</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>

<p><strong>Business Profile (JSON Object):</strong></p>

<p><strong>Core Business Information:</strong></p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>company_name</td>
<td>Legal company name</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>registration_number</td>
<td>Company registration number</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>registration_country</td>
<td>ISO country code where company is registered (2-3 chars)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>industry</td>
<td>Industry classification (e.g., &#39;Financial Services&#39;, &#39;Technology&#39;, &#39;Healthcare&#39;, &#39;Retail&#39;)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>purpose_of_account</td>
<td>Business purpose for the account</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>expected_monthly_volume_usd</td>
<td>Expected monthly trading volume in USD</td>
<td>Yes</td>
<td>number</td>
</tr>
<tr>
<td>jurisdictions_of_operation</td>
<td>Array of country codes where business operates</td>
<td>No</td>
<td>array of strings</td>
</tr>
<tr>
<td>website</td>
<td>Company website URL</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>employee_count</td>
<td>Number of employees</td>
<td>No</td>
<td>number</td>
</tr>
<tr>
<td>address</td>
<td>Business street address</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>city</td>
<td>Business city</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>postcode</td>
<td>Business postal code</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>country</td>
<td>Business country ISO code (2 chars)</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>license_status</td>
<td>License status: &#39;Licensed&#39;, &#39;Not Licensed&#39;, &#39;Pending&#39;</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>license_number</td>
<td>License number (required if license_status is &#39;Licensed&#39;)</td>
<td>Conditional</td>
<td>string</td>
</tr>
<tr>
<td>license_jurisdictions</td>
<td>Array of country codes where licensed (required if license_status is &#39;Licensed&#39;)</td>
<td>Conditional</td>
<td>array of strings</td>
</tr>
</tbody></table>

<p><strong>UBOs Array (Ultimate Beneficial Owners) - At least 1 required:</strong></p>

<p>Each UBO object must include:</p>

<p><strong>Personal Information:</strong></p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>UBO email address</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>first_name</td>
<td>UBO first name</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>last_name</td>
<td>UBO last name</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>phone_number</td>
<td>UBO phone number</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>dob</td>
<td>Date of birth (YYYY-MM-DD, must be 18+)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>address</td>
<td>UBO street address</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>postcode</td>
<td>UBO postal code</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>city</td>
<td>UBO city</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>country</td>
<td>UBO country ISO code (2 chars)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>nationality</td>
<td>UBO nationality ISO code (2 chars)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>id_number</td>
<td>UBO national ID or passport number</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>occupation</td>
<td>UBO occupation</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>source_of_funds</td>
<td>UBO source of funds</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>ownership_percentage</td>
<td>Ownership percentage (minimum 5%, maximum 100%)</td>
<td>Yes</td>
<td>number</td>
</tr>
<tr>
<td>is_director</td>
<td>Is the UBO a company director?</td>
<td>No</td>
<td>boolean</td>
</tr>
<tr>
<td>is_authorized_signatory</td>
<td>Is the UBO an authorized signatory?</td>
<td>No</td>
<td>boolean</td>
</tr>
<tr>
<td>is_pep_occupation</td>
<td>Is the UBO a PEP by occupation?</td>
<td>No</td>
<td>boolean</td>
</tr>
<tr>
<td>pep_occupation_data</td>
<td>Details if is_pep_occupation is true</td>
<td>Conditional</td>
<td>string</td>
</tr>
<tr>
<td>is_pep_related</td>
<td>Is the UBO related to a PEP?</td>
<td>No</td>
<td>boolean</td>
</tr>
<tr>
<td>pep_related_data</td>
<td>Details if is_pep_related is true</td>
<td>Conditional</td>
<td>string</td>
</tr>
<tr>
<td>is_pip</td>
<td>Is the UBO a Prominent Influential Person?</td>
<td>No</td>
<td>boolean</td>
</tr>
<tr>
<td>pip_data</td>
<td>Details if is_pip is true</td>
<td>Conditional</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-37'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>201</td>
<td>Business customer created successfully</td>
<td><a href="#customer">Customer</a></td>
</tr>
<tr>
<td>422</td>
<td>Validation error</td>
<td>Error array</td>
</tr>
</tbody></table>
<h2 id='get-list-customers'><span class="request-type__get">GET</span> List Customers</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// listCustomers.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">listCustomers</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/persona/resource/customers?page=1&amp;limit=100`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">listCustomers</span><span class="p">();</span>
</code></pre></div>
<p><code>/persona/resource/customers</code></p>
<h3 id='description-38'>Description</h3>
<p>Get a paginated list of customers. Merchants see only their own customers. Aggregators see all customers (their own + all their merchants&#39; customers). Aggregators can filter by specific merchant using <code>merchant_uid</code>.</p>
<h3 id='parameters-34'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>page</td>
<td>query</td>
<td>Page number (defaults to 1)</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>limit</td>
<td>query</td>
<td>Number of results per page (default: 100, max: 1000)</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>merchant_uid</td>
<td>query</td>
<td>Filter by merchant UID (aggregators only)</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-38'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>List of customers with pagination</td>
<td>[ <a href="#customer">Customer</a> ]</td>
</tr>
</tbody></table>

<blockquote>
<p>Response Headers:</p>
</blockquote>
<div class="highlight"><pre class="highlight plaintext"><code>Page: 1
Per-Page: 100
Total: 150
</code></pre></div>
<blockquote>
<p>Response Body (Array):</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID123456789ABC"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"account_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CUST-001"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"custom_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CUST-001"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"kyc_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"verified"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-01T00:00:00.000Z"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID987654321XYZ"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"account_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CUST-002"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"custom_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CUST-002"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"kyc_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"verified"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-02T00:00:00.000Z"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p><strong>Note:</strong> Pagination information is returned in HTTP headers (<code>Page</code>, <code>Per-Page</code>, <code>Total</code>), not in the response body.</p>
<h2 id='get-get-customer-by-uid'><span class="request-type__get">GET</span> Get Customer by UID</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// getCustomer.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">getCustomer</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">customerUid</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">ID123456789ABC</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/persona/resource/customers/</span><span class="p">${</span><span class="nx">customerUid</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">getCustomer</span><span class="p">();</span>
</code></pre></div>
<p><code>/persona/resource/customers/{uid}</code></p>
<h3 id='description-39'>Description</h3>
<p>Retrieve a specific customer with full details including profile, phone, labels, and business information (if applicable).</p>
<h3 id='parameters-35'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>uid</td>
<td>path</td>
<td>Customer identifier</td>
<td>Yes</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-39'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Customer found</td>
<td><a href="#customer">Customer</a></td>
</tr>
<tr>
<td>404</td>
<td>Not found</td>
<td>Error array</td>
</tr>
</tbody></table>
<h2 id='put-update-customer'><span class="request-type__put">PUT</span> Update Customer</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// updateCustomer.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">updateCustomer</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">PUT</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">customerUid</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">ID123456789ABC</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/persona/resource/customers/</span><span class="p">${</span><span class="nx">customerUid</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">updateData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">custom_id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">CUST-001-UPDATED</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">external_verification_url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://example.com/verify/updated</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">updateData</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">updateCustomer</span><span class="p">();</span>
</code></pre></div>
<p><code>/persona/resource/customers/{uid}</code></p>
<h3 id='description-40'>Description</h3>
<p>Update customer metadata (custom_id and external_verification_url).</p>
<h3 id='parameters-36'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>uid</td>
<td>path</td>
<td>Customer identifier</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>custom_id</td>
<td>formData</td>
<td>Updated custom identifier</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>external_verification_url</td>
<td>formData</td>
<td>Updated external verification URL</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-40'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Customer updated successfully</td>
<td><a href="#customer">Customer</a></td>
</tr>
<tr>
<td>404</td>
<td>Not found</td>
<td>Error array</td>
</tr>
<tr>
<td>422</td>
<td>Validation error</td>
<td>Error array</td>
</tr>
</tbody></table>
<h2 id='post-upload-individual-customer-documents'><span class="request-type__post">POST</span> Upload Individual Customer Documents</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// uploadIndividualDocuments.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">FormData</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">form-data</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">uploadDocuments</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">customerUid</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/verification/customers/documents`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="c1">// Document 1: ID Front</span>
  <span class="kd">const</span> <span class="nx">formData1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
  <span class="nx">formData1</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">upload</span><span class="dl">"</span><span class="p">,</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="dl">"</span><span class="s2">./id_front.jpg</span><span class="dl">"</span><span class="p">));</span>
  <span class="nx">formData1</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Passport</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">formData1</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">customer_uid</span><span class="dl">"</span><span class="p">,</span> <span class="nx">customerUid</span><span class="p">);</span>
  <span class="nx">formData1</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_number</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">M12345678</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">formData1</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_expire</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">2028-12-31</span><span class="dl">"</span><span class="p">);</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">formData1</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span><span class="nx">headers</span><span class="p">,</span> <span class="p">...</span><span class="nx">formData1</span><span class="p">.</span><span class="nx">getHeaders</span><span class="p">()</span> <span class="p">},</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">ID front uploaded successfully</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error uploading ID front:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Document 2: ID Back</span>
  <span class="kd">const</span> <span class="nx">formData2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
  <span class="nx">formData2</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">upload</span><span class="dl">"</span><span class="p">,</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="dl">"</span><span class="s2">./id_back.jpg</span><span class="dl">"</span><span class="p">));</span>
  <span class="nx">formData2</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Drivers license back</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">formData2</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">customer_uid</span><span class="dl">"</span><span class="p">,</span> <span class="nx">customerUid</span><span class="p">);</span>
  <span class="nx">formData2</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_number</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">DL987654</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">formData2</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_expire</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">2028-12-31</span><span class="dl">"</span><span class="p">);</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">formData2</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span><span class="nx">headers</span><span class="p">,</span> <span class="p">...</span><span class="nx">formData2</span><span class="p">.</span><span class="nx">getHeaders</span><span class="p">()</span> <span class="p">},</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">ID back uploaded successfully</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error uploading ID back:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Document 3: Selfie</span>
  <span class="kd">const</span> <span class="nx">formData3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
  <span class="nx">formData3</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">upload</span><span class="dl">"</span><span class="p">,</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="dl">"</span><span class="s2">./selfie.jpg</span><span class="dl">"</span><span class="p">));</span>
  <span class="nx">formData3</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Selfie</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">formData3</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">customer_uid</span><span class="dl">"</span><span class="p">,</span> <span class="nx">customerUid</span><span class="p">);</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">formData3</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span><span class="nx">headers</span><span class="p">,</span> <span class="p">...</span><span class="nx">formData3</span><span class="p">.</span><span class="nx">getHeaders</span><span class="p">()</span> <span class="p">},</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Selfie uploaded successfully</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error uploading selfie:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Document 4: Proof of Address</span>
  <span class="kd">const</span> <span class="nx">formData4</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
  <span class="nx">formData4</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">upload</span><span class="dl">"</span><span class="p">,</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="dl">"</span><span class="s2">./proof_of_address.pdf</span><span class="dl">"</span><span class="p">));</span>
  <span class="nx">formData4</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Proof of Address</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">formData4</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">customer_uid</span><span class="dl">"</span><span class="p">,</span> <span class="nx">customerUid</span><span class="p">);</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">formData4</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span><span class="nx">headers</span><span class="p">,</span> <span class="p">...</span><span class="nx">formData4</span><span class="p">.</span><span class="nx">getHeaders</span><span class="p">()</span> <span class="p">},</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Proof of Address uploaded successfully</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error uploading proof of address:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Document 5: Liveness (upload last - triggers verification)</span>
  <span class="kd">const</span> <span class="nx">formData5</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
  <span class="nx">formData5</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">upload</span><span class="dl">"</span><span class="p">,</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="dl">"</span><span class="s2">./liveness.jpg</span><span class="dl">"</span><span class="p">));</span>
  <span class="nx">formData5</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Liveness</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">formData5</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">customer_uid</span><span class="dl">"</span><span class="p">,</span> <span class="nx">customerUid</span><span class="p">);</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">formData5</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span><span class="nx">headers</span><span class="p">,</span> <span class="p">...</span><span class="nx">formData5</span><span class="p">.</span><span class="nx">getHeaders</span><span class="p">()</span> <span class="p">},</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Liveness uploaded successfully - verification triggered</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error uploading liveness:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Upload documents after customer creation</span>
<span class="nx">uploadDocuments</span><span class="p">(</span><span class="dl">"</span><span class="s2">ID123456789ABC</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div>
<p><code>/api/v2/verification/customers/documents</code></p>
<h3 id='description-41'>Description</h3>
<p>Upload KYC verification documents for individual customers. Multiple documents are required for complete verification:</p>

<ul>
<li><strong>ID document</strong> (front side, plus back side for identity_card/driver_license)</li>
<li><strong>Selfie</strong> (holding ID document)</li>
<li><strong>Liveness</strong> (live photo/video - triggers automatic verification)</li>
<li><strong>Proof of Address</strong> (utility bill, bank statement, etc.)</li>
</ul>

<p>Each document must be uploaded as a separate request with FormData.</p>

<p><strong>Maximum file size:</strong> 10MB per document.</p>

<p><strong>Note:</strong> This endpoint should be called after creating an individual customer using the &quot;Create Individual Customer&quot; endpoint. Use the customer UID returned from the creation response. Upload the <strong>Liveness</strong> document last as it triggers the automated verification workflow.</p>
<h3 id='parameters-37'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>upload</td>
<td>formData</td>
<td>The document file (image file: JPG, PNG, PDF) - Max 4MB</td>
<td>Yes</td>
<td>File</td>
</tr>
<tr>
<td>doc_type</td>
<td>formData</td>
<td>Document type (see Available Document Types below)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>customer_uid</td>
<td>formData</td>
<td>Customer UID from the customer creation response</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>doc_number</td>
<td>formData</td>
<td>ID document number (optional for selfie)</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>doc_expire</td>
<td>formData</td>
<td>Document expiry date in YYYY-MM-DD format (optional for selfie)</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='required-documents'>Required Documents</h3>
<p>The following documents must be uploaded for individual customers:</p>

<ol>
<li><strong>ID Document (Front)</strong> - Front image of the identification document</li>
</ol>

<ul>
<li><code>doc_type</code>: Use the document type from customer creation (&#39;Passport&#39;, &#39;Identity card&#39;, or &#39;Driver license&#39;)</li>
<li>Include <code>doc_number</code> and <code>doc_expire</code></li>
<li>Note: Passport is single-sided; Identity card and Driver license require back side as well</li>
</ul>

<ol>
<li><strong>ID Document (Back)</strong> - Back image of identification document (Identity card and Driver license only)</li>
</ol>

<ul>
<li><code>doc_type</code>: Add &quot; back&quot; suffix to the document type (e.g., &#39;Drivers license back&#39;, &#39;Identity card back&#39;)</li>
<li>Include <code>doc_number</code> and <code>doc_expire</code></li>
<li>Not required for Passport</li>
</ul>

<ol>
<li><strong>Selfie</strong> - Photograph of customer holding their ID document</li>
</ol>

<ul>
<li><code>doc_type</code>: &#39;Selfie&#39;</li>
<li><code>doc_number</code> and <code>doc_expire</code> are optional</li>
</ul>

<ol>
<li><strong>Liveness</strong> - Live photo or video verification</li>
</ol>

<ul>
<li><code>doc_type</code>: &#39;Liveness&#39;</li>
<li>This document triggers the automated verification workflow</li>
<li>Upload this document last, after all other documents are uploaded</li>
<li><code>doc_number</code> and <code>doc_expire</code> are optional</li>
</ul>

<ol>
<li><strong>Proof of Address</strong> - Utility bill, bank statement, or lease agreement

<ul>
<li><code>doc_type</code>: &#39;Proof of Address&#39;</li>
<li>Document must be less than 3 months old</li>
<li><code>doc_number</code> and <code>doc_expire</code> are optional</li>
</ul></li>
</ol>
<h3 id='available-document-types'>Available Document Types</h3>
<p>Valid <code>doc_type</code> values for individual customer KYC documents:</p>

<p><strong>Note:</strong> Use Title Case format exactly as shown below (e.g., &quot;Passport&quot;, &quot;Proof of Address&quot;, &quot;Board Resolution&quot;). The system automatically converts these to internal format.</p>

<ul>
<li><code>Passport</code></li>
<li><code>Passport other</code></li>
<li><code>Identity card</code></li>
<li><code>Identity book</code></li>
<li><code>Driver license</code></li>
<li><code>Identity card front</code></li>
<li><code>Driver license front</code></li>
<li><code>Identity card back</code></li>
<li><code>Driver license back</code></li>
<li><code>Proof of Address</code></li>
<li><code>Source of Funds</code></li>
<li><code>Selfie</code></li>
<li><code>Liveness</code></li>
<li><code>Drivers license</code></li>
<li><code>Drivers license back</code></li>
<li><code>Green Identity Book</code></li>
</ul>
<h3 id='responses-41'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Document uploaded successfully</td>
<td>Success object</td>
</tr>
<tr>
<td>400</td>
<td>Invalid doc_type</td>
<td>Error array</td>
</tr>
<tr>
<td>422</td>
<td>Validation error</td>
<td>Error array</td>
</tr>
</tbody></table>
<h2 id='post-upload-business-customer-documents'><span class="request-type__post">POST</span> Upload Business Customer Documents</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// uploadBusinessDocuments.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">FormData</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">form-data</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">uploadBusinessDocument</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">customerUid</span><span class="p">,</span> <span class="nx">documentType</span><span class="p">,</span> <span class="nx">filePath</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/verification/customers/documents`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
  <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">upload</span><span class="dl">"</span><span class="p">,</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">filePath</span><span class="p">));</span>
  <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_type</span><span class="dl">"</span><span class="p">,</span> <span class="nx">documentType</span><span class="p">);</span>
  <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">customer_uid</span><span class="dl">"</span><span class="p">,</span> <span class="nx">customerUid</span><span class="p">);</span>
  <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_number</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">N/A</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_expire</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">N/A</span><span class="dl">"</span><span class="p">);</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">formData</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span><span class="nx">headers</span><span class="p">,</span> <span class="p">...</span><span class="nx">formData</span><span class="p">.</span><span class="nx">getHeaders</span><span class="p">()</span> <span class="p">},</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">documentType</span><span class="p">}</span><span class="s2"> uploaded successfully`</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Error uploading </span><span class="p">${</span><span class="nx">documentType</span><span class="p">}</span><span class="s2">:`</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Upload all required business documents</span>
<span class="kd">const</span> <span class="nx">uploadAllBusinessDocuments</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">customerUid</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">documents</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Board Resolution</span><span class="dl">"</span><span class="p">,</span> <span class="na">file</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./board_resolution.pdf</span><span class="dl">"</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Company Registration</span><span class="dl">"</span><span class="p">,</span> <span class="na">file</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./company_registration.pdf</span><span class="dl">"</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">AML Policy</span><span class="dl">"</span><span class="p">,</span> <span class="na">file</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./aml_policy.pdf</span><span class="dl">"</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Business License</span><span class="dl">"</span><span class="p">,</span> <span class="na">file</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./business_license.pdf</span><span class="dl">"</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Business Proof of Address</span><span class="dl">"</span><span class="p">,</span> <span class="na">file</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./proof_of_address.pdf</span><span class="dl">"</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Shareholder Certificate</span><span class="dl">"</span><span class="p">,</span> <span class="na">file</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./shareholder_certificate.pdf</span><span class="dl">"</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Incorporation Certificate</span><span class="dl">"</span><span class="p">,</span> <span class="na">file</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./incorporation_cert.pdf</span><span class="dl">"</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Bank Statement</span><span class="dl">"</span><span class="p">,</span> <span class="na">file</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./bank_statement.pdf</span><span class="dl">"</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Tax Statement</span><span class="dl">"</span><span class="p">,</span> <span class="na">file</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./tax_statement.pdf</span><span class="dl">"</span> <span class="p">},</span>
  <span class="p">];</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">doc</span> <span class="k">of</span> <span class="nx">documents</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">uploadBusinessDocument</span><span class="p">(</span><span class="nx">customerUid</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">file</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">All business documents uploaded successfully</span><span class="dl">"</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Upload documents after business customer creation</span>
<span class="nx">uploadAllBusinessDocuments</span><span class="p">(</span><span class="dl">"</span><span class="s2">ID987654321XYZ</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div>
<p><code>/api/v2/verification/customers/documents</code></p>
<h3 id='description-42'>Description</h3>
<p>Upload KYB verification documents for business customers. Nine business documents are required for complete verification. Additionally, all UBOs (Ultimate Beneficial Owners) must upload their individual KYC documents (see &quot;Upload UBO Documents&quot; section below). Each document must be uploaded as a separate request with FormData.</p>

<p><strong>Maximum file size:</strong> 10MB per document.</p>

<p><strong>Note:</strong> This endpoint should be called after creating a business customer using the &quot;Create Business Customer&quot; endpoint. Use the customer UID returned from the creation response. When all 9 business documents and all UBO documents are uploaded, the system will notify administrators for manual review.</p>
<h3 id='parameters-38'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>upload</td>
<td>formData</td>
<td>The document file (PDF, JPG, PNG) - Max 10MB</td>
<td>Yes</td>
<td>File</td>
</tr>
<tr>
<td>doc_type</td>
<td>formData</td>
<td>Business document type (see list below)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>customer_uid</td>
<td>formData</td>
<td>Customer UID from the business customer creation response</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>doc_number</td>
<td>formData</td>
<td>Use &#39;N/A&#39; for business documents</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>doc_expire</td>
<td>formData</td>
<td>Use &#39;N/A&#39; for business documents</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='available-business-document-types'>Available Business Document Types</h3>
<p>Valid <code>doc_type</code> values for business customer KYB documents:</p>

<p><strong>Note:</strong> Use Title Case format exactly as shown below (e.g., &quot;Board Resolution&quot;, &quot;Company Registration&quot;). The system automatically converts these to internal format.</p>

<ul>
<li><code>Board Resolution</code> - Board resolution authorizing account opening, signed by authorized directors</li>
<li><code>Company Registration</code> - Official company registration certificate proving legal existence</li>
<li><code>AML Policy</code> - Anti-Money Laundering policy document</li>
<li><code>Business License</code> - Industry-specific operating license (if applicable)</li>
<li><code>Business Proof of Address</code> - Utility bill or lease agreement (must be less than 3 months old)</li>
<li><code>Shareholder Certificate</code> - Official list of company shareholders showing ownership structure</li>
<li><code>Incorporation Certificate</code> - Certificate of incorporation / Articles of Association</li>
<li><code>Bank Statement</code> - Recent company bank statement (must be less than 3 months old)</li>
<li><code>Tax Statement</code> - Valid tax compliance certificate proving good standing with tax authorities</li>
</ul>
<h3 id='responses-42'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Document uploaded successfully</td>
<td>Success object</td>
</tr>
<tr>
<td>400</td>
<td>Invalid doc_type</td>
<td>Error array</td>
</tr>
<tr>
<td>422</td>
<td>Validation error</td>
<td>Error array</td>
</tr>
</tbody></table>
<h2 id='post-upload-ubo-documents'><span class="request-type__post">POST</span> Upload UBO Documents</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// uploadUBODocuments.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">FormData</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">form-data</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">uploadUBODocuments</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">uboUid</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/verification/customers/documents`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="c1">// Document 1: ID Front (Passport example)</span>
  <span class="kd">const</span> <span class="nx">formData1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
  <span class="nx">formData1</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">upload</span><span class="dl">"</span><span class="p">,</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="dl">"</span><span class="s2">./ubo_passport.jpg</span><span class="dl">"</span><span class="p">));</span>
  <span class="nx">formData1</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Passport</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">formData1</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">customer_uid</span><span class="dl">"</span><span class="p">,</span> <span class="nx">uboUid</span><span class="p">);</span>
  <span class="nx">formData1</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_number</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">M98765432</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">formData1</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_expire</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">2029-06-30</span><span class="dl">"</span><span class="p">);</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">formData1</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span><span class="nx">headers</span><span class="p">,</span> <span class="p">...</span><span class="nx">formData1</span><span class="p">.</span><span class="nx">getHeaders</span><span class="p">()</span> <span class="p">},</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">UBO ID uploaded successfully</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error uploading UBO ID:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Document 2: Selfie</span>
  <span class="kd">const</span> <span class="nx">formData2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
  <span class="nx">formData2</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">upload</span><span class="dl">"</span><span class="p">,</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="dl">"</span><span class="s2">./ubo_selfie.jpg</span><span class="dl">"</span><span class="p">));</span>
  <span class="nx">formData2</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Selfie</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">formData2</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">customer_uid</span><span class="dl">"</span><span class="p">,</span> <span class="nx">uboUid</span><span class="p">);</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">formData2</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span><span class="nx">headers</span><span class="p">,</span> <span class="p">...</span><span class="nx">formData2</span><span class="p">.</span><span class="nx">getHeaders</span><span class="p">()</span> <span class="p">},</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">UBO Selfie uploaded successfully</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error uploading UBO selfie:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Document 3: Proof of Address</span>
  <span class="kd">const</span> <span class="nx">formData3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
  <span class="nx">formData3</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">upload</span><span class="dl">"</span><span class="p">,</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="dl">"</span><span class="s2">./ubo_proof_of_address.pdf</span><span class="dl">"</span><span class="p">));</span>
  <span class="nx">formData3</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Proof of Address</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">formData3</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">customer_uid</span><span class="dl">"</span><span class="p">,</span> <span class="nx">uboUid</span><span class="p">);</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">formData3</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span><span class="nx">headers</span><span class="p">,</span> <span class="p">...</span><span class="nx">formData3</span><span class="p">.</span><span class="nx">getHeaders</span><span class="p">()</span> <span class="p">},</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">UBO Proof of Address uploaded successfully</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error uploading UBO proof of address:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Document 4: Liveness (upload last - triggers verification)</span>
  <span class="kd">const</span> <span class="nx">formData4</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
  <span class="nx">formData4</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">upload</span><span class="dl">"</span><span class="p">,</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="dl">"</span><span class="s2">./ubo_liveness.jpg</span><span class="dl">"</span><span class="p">));</span>
  <span class="nx">formData4</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">doc_type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Liveness</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">formData4</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">customer_uid</span><span class="dl">"</span><span class="p">,</span> <span class="nx">uboUid</span><span class="p">);</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">formData4</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span><span class="nx">headers</span><span class="p">,</span> <span class="p">...</span><span class="nx">formData4</span><span class="p">.</span><span class="nx">getHeaders</span><span class="p">()</span> <span class="p">},</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">UBO Liveness uploaded successfully</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error uploading UBO liveness:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Upload documents for each UBO</span>
<span class="c1">// UBO UIDs are returned when creating the business customer</span>
<span class="nx">uploadUBODocuments</span><span class="p">(</span><span class="dl">"</span><span class="s2">ID_UBO_001_ABC</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">uploadUBODocuments</span><span class="p">(</span><span class="dl">"</span><span class="s2">ID_UBO_002_XYZ</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div>
<p><code>/api/v2/verification/customers/documents</code></p>
<h3 id='description-43'>Description</h3>
<p>Upload KYC verification documents for Ultimate Beneficial Owners (UBOs) of business customers. Each UBO must complete individual KYC verification by uploading their personal documents. This is required in addition to the business entity documents.</p>

<p><strong>When creating a business customer</strong>, UBO user accounts are automatically created and their UIDs are returned in the creation response. Use these UBO UIDs as the <code>customer_uid</code> when uploading UBO documents.</p>

<p><strong>Business KYB completion requires</strong>:</p>

<ol>
<li>All 9 business entity documents uploaded</li>
<li><strong>All UBOs must have complete KYC documents</strong></li>
</ol>

<p>Each document must be uploaded as a separate request with FormData.</p>

<p><strong>Maximum file size:</strong> 10MB per document.</p>
<h3 id='parameters-39'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>upload</td>
<td>formData</td>
<td>The document file (image file: JPG, PNG, PDF) - Max 10MB</td>
<td>Yes</td>
<td>File</td>
</tr>
<tr>
<td>doc_type</td>
<td>formData</td>
<td>Document type (see Required UBO Documents below)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>customer_uid</td>
<td>formData</td>
<td>UBO&#39;s UID from the business customer creation response</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>doc_number</td>
<td>formData</td>
<td>ID document number (optional for selfie and liveness)</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>doc_expire</td>
<td>formData</td>
<td>Document expiry date in YYYY-MM-DD format</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='required-ubo-documents'>Required UBO Documents</h3>
<p>Each UBO must upload the following documents:</p>

<ol>
<li><strong>ID Document (Front)</strong> - Front image of the identification document</li>
</ol>

<ul>
<li><code>doc_type</code>: &#39;Passport&#39;, &#39;Identity card&#39;, or &#39;Driver license&#39;</li>
<li>Include <code>doc_number</code> and <code>doc_expire</code></li>
<li>Note: Passport is single-sided; Identity card and Driver license require back side as well</li>
</ul>

<ol>
<li><strong>ID Document (Back)</strong> - Back image (Identity card and Driver license only)</li>
</ol>

<ul>
<li><code>doc_type</code>: &#39;Identity card back&#39; or &#39;Drivers license back&#39;</li>
<li>Include <code>doc_number</code> and <code>doc_expire</code></li>
<li>Not required for Passport</li>
</ul>

<ol>
<li><strong>Selfie</strong> - Photograph of UBO holding their ID document</li>
</ol>

<ul>
<li><code>doc_type</code>: &#39;Selfie&#39;</li>
<li><code>doc_number</code> and <code>doc_expire</code> are optional</li>
</ul>

<ol>
<li><strong>Proof of Address</strong> - Utility bill, bank statement, or lease agreement</li>
</ol>

<ul>
<li><code>doc_type</code>: &#39;Proof of Address&#39;</li>
<li>Document must be less than 3 months old</li>
<li><code>doc_number</code> and <code>doc_expire</code> are optional</li>
</ul>

<ol>
<li><strong>Liveness</strong> - Live photo or video verification

<ul>
<li><code>doc_type</code>: &#39;Liveness&#39;</li>
<li>Upload this document last, after all other UBO documents</li>
<li><code>doc_number</code> and <code>doc_expire</code> are optional</li>
</ul></li>
</ol>
<h3 id='available-document-types-for-ubos'>Available Document Types for UBOs</h3>
<p>Valid <code>doc_type</code> values for UBO KYC documents (same as individual customers):</p>

<ul>
<li><code>Passport</code></li>
<li><code>Passport other</code></li>
<li><code>Identity card</code></li>
<li><code>Identity card front</code></li>
<li><code>Identity card back</code></li>
<li><code>Identity book</code></li>
<li><code>Green Identity Book</code></li>
<li><code>Driver license</code></li>
<li><code>Driver license front</code></li>
<li><code>Drivers license</code></li>
<li><code>Drivers license back</code></li>
<li><code>Driver license back</code></li>
<li><code>Selfie</code></li>
<li><code>Liveness</code></li>
<li><code>Proof of Address</code></li>
</ul>
<h3 id='responses-43'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Document uploaded successfully</td>
<td>Success object</td>
</tr>
<tr>
<td>400</td>
<td>Invalid doc_type</td>
<td>Error array</td>
</tr>
<tr>
<td>422</td>
<td>Validation error</td>
<td>Error array</td>
</tr>
</tbody></table>
<h3 id='business-kyb-completion'>Business KYB Completion</h3>
<p><strong>When all requirements are met:</strong></p>

<ul>
<li>All 9 business documents uploaded âœ“</li>
<li>All UBOs have uploaded their complete KYC documents (4-5 documents each) âœ“</li>
</ul>

<p><strong>The system will:</strong></p>

<ul>
<li>Automatically notify administrators via Slack for manual review</li>
<li>Business customer remains in &quot;pending&quot; status until admin approval</li>
<li>No automatic verification for business customers (always requires manual review)</li>
</ul>
<h2 id='post-create-payment-reference'><span class="request-type__post">POST</span> Create payment reference</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// createPaymentReference.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com/api/v2/atlas/account/payments</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">createPaymentReference</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Apikey</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">your_api_key</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Nonce</span><span class="dl">"</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
    <span class="dl">"</span><span class="s2">X-Auth-Signature</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">your_generated_signature</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">paymentData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">uid</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ID123456789</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">currency</span><span class="p">:</span> <span class="dl">"</span><span class="s2">btc</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">deposit_action</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">action</span><span class="p">:</span> <span class="dl">"</span><span class="s2">aggregate_convert_and_withdraw</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">target_currency</span><span class="p">:</span> <span class="dl">"</span><span class="s2">zar</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">beneficiary_id</span><span class="p">:</span> <span class="mi">456</span><span class="p">,</span>
      <span class="na">max_slippage</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">webhook_url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://merchant.com/webhooks/deposits</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">webhook_secret</span><span class="p">:</span> <span class="dl">"</span><span class="s2">my_secret_key</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">webhook_protocol</span><span class="p">:</span> <span class="dl">"</span><span class="s2">hmac</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">post</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">paymentData</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">createPaymentReference</span><span class="p">();</span>
</code></pre></div>
<p><code>/api/v2/account/payments</code></p>
<h3 id='description-44'>Description</h3>
<p>Create a new payment reference for a customer account. The payment reference provides a unique deposit reference code that the customer can use when making deposits. Optionally configure automated actions (aggregate, convert, withdraw) that execute when deposits are received. You can optionally provide a webhook url, with optional secret and protocol that will be sent as a header with the webhook notification.</p>

<p><strong>Access:</strong> Merchants and Aggregators only</p>

<p><strong>Webhook Notifications:</strong> When the configured action completes successfully, a webhook notification will be sent to the provided webhook URL (optional).</p>

<p>When the configured action completes <strong>successfully</strong>, a webhook notification will be sent to the provided webhook URL (optional).</p>
<h3 id='request-details'>Request Details</h3>
<ul>
<li><strong>HTTP Method</strong>: <code>POST</code></li>
<li><strong>Content-Type</strong>: <code>application/json</code></li>
</ul>
<h3 id='authentication-protocol-modes-webhook_protocol'>Authentication / Protocol Modes (<code>webhook_protocol</code>)</h3>
<table><thead>
<tr>
<th>webhook_protocol</th>
<th>Behavior</th>
<th>Header <code>X-Auth-Webhook</code> contains</th>
</tr>
</thead><tbody>
<tr>
<td><code>hmac</code> (recommended)</td>
<td>The raw request body is signed with <strong>HMAC-SHA256</strong> using your <code>webhook_secret</code>. The signature is <strong>base64-encoded</strong>.</td>
<td><code>Base64(HMAC-SHA256(body, webhook_secret))</code></td>
</tr>
<tr>
<td><code>plain_text</code></td>
<td>The secret itself is sent in clear text (not recommended for production)</td>
<td>The raw <code>webhook_secret</code> value</td>
</tr>
<tr>
<td>not set (default)</td>
<td>No authentication header is added</td>
<td>Header is omitted</td>
</tr>
</tbody></table>
<h3 id='successful-response-requirement'>Successful Response Requirement</h3>
<p>Your endpoint <strong>must</strong> return an HTTP <code>2xx</code> status code (e.g., 200, 201, 204) as quickly as possible.</p>

<ul>
<li>Any non-2xx response or timeout will trigger retries.</li>
<li>Retry schedule (exponential backoff):</li>
</ul>

<table><thead>
<tr>
<th>Attempt</th>
<th>Delay</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>30 seconds</td>
<td>Initial retry after first failure</td>
</tr>
<tr>
<td>2</td>
<td>60 seconds</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>5 minutes</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>10 minutes</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>30 minutes</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td>1 hour</td>
<td></td>
</tr>
<tr>
<td>7</td>
<td>2 hours</td>
<td>Final retry attempt</td>
</tr>
</tbody></table>
<h3 id='recommendations'>Recommendations</h3>
<ul>
<li>Use <code>hmac</code> mode in production.</li>
<li>Verify the <code>X-Auth-Webhook</code> signature on your side by recomputing HMAC-SHA256 of the raw request body with your secret and comparing it to the header value.</li>
<li>Respond immediately with <code>200 OK</code> (you can validate the signature asynchronously if needed).</li>
</ul>
<h3 id='webhook-verification'>Webhook Verification</h3>
<p>When you receive a webhook notification, you should verify its authenticity before processing.</p>
<h4 id='verifying-hmac-signatures-recommended'>Verifying HMAC Signatures (Recommended)</h4>
<p>For <code>webhook_protocol: &quot;hmac&quot;</code>, the payload is HMAC signed and BASE64 encoded (<code>BASE64(HMAC(payload, secret))</code>), and then sent. Validate the sent HMAC signature by repeating what was done by Cape Crypto: HMAC sign the received body with your secret, then encode the resulting HMAC signature to BASE64, and finally compare the received BASE64 encoded signture with your calculated BASE64 encoded signature.</p>

<p><strong>Warning:</strong> Plain text mode is not recommended for production as the secret is transmitted in clear text.</p>
<h4 id='no-authentication-mode'>No Authentication Mode</h4>
<p>For <code>webhook_protocol: &quot;none&quot;</code> or when not set, no <code>X-Auth-Webhook</code> header is sent. Consider implementing additional security measures like IP whitelisting or using webhook signing URLs.</p>
<h3 id='parameters-40'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>uid</td>
<td>body</td>
<td>Customer sub-account UID</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>currency</td>
<td>body</td>
<td>Currency code (e.g., &quot;btc&quot;, &quot;zar&quot;)</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>deposit_action</td>
<td>body</td>
<td>Automated action configuration (see Deposit Action Object below)</td>
<td>No</td>
<td>object</td>
</tr>
<tr>
<td>webhook_url</td>
<td>body</td>
<td>Webhook URL for notifications</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>webhook_secret</td>
<td>body</td>
<td>Webhook secret for HMAC signing</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>webhook_protocol</td>
<td>body</td>
<td>Webhook protocol: &quot;hmac&quot;, &quot;plain_text&quot;, or &quot;none&quot; (default: &quot;none&quot;)</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>

<p><strong>Deposit Action Object:</strong></p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>action</td>
<td>Action type: &quot;none&quot;, &quot;aggregate&quot;, &quot;convert_and_withdraw&quot;, &quot;aggregate_convert_and_withdraw&quot;</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>target_currency</td>
<td>Target currency for conversion (required if action includes conversion)</td>
<td>Conditional</td>
<td>string</td>
</tr>
<tr>
<td>beneficiary_id</td>
<td>Beneficiary ID for withdrawal (required if action includes withdrawal)</td>
<td>Conditional</td>
<td>integer</td>
</tr>
<tr>
<td>lightning_invoice</td>
<td>Lightning invoice for withdrawal (alternative to beneficiary_id)</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>max_slippage</td>
<td>Maximum slippage percentage for conversion (default: 1.0, max: 5.0)</td>
<td>No</td>
<td>decimal</td>
</tr>
</tbody></table>

<p><strong>Deposit Action Types:</strong></p>

<ul>
<li><strong>none</strong>: No automated action, deposit sits in account</li>
<li><strong>aggregate</strong>: Combine multiple small deposits into one before processing</li>
<li><strong>convert_and_withdraw</strong>: Convert currency and withdraw to beneficiary</li>
<li><strong>aggregate_convert_and_withdraw</strong>: Aggregate deposits, then convert and withdraw</li>
</ul>
<h3 id='responses-44'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>201</td>
<td>Payment reference created</td>
<td>PaymentReference</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden (not merchant/aggregator)</td>
<td>Error array</td>
</tr>
<tr>
<td>422</td>
<td>Validation error</td>
<td>Error array</td>
</tr>
</tbody></table>

<p><strong>Example Response:</strong></p>

<p><strong>API Response - Payment Reference Created:</strong></p>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// Request Body examples - POST /api/v2/account/payments</span>
</code></pre></div><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
  </span><span class="nl">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAY-ABC123"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID123456789"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btc"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"deposit_action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aggregate_convert_and_withdraw"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"target_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"beneficiary_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lightning_invoice"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"max_slippage"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pending_deposit"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"webhook_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://merchant.com/webhooks/deposits"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"webhook_protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hmac"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-15T10:30:00Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-15T10:30:00Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='additional-request-examples'>Additional Request Examples</h3>
<p><strong>Example: Simple Deposit (No Action)</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID123456789"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btc"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Example: Aggregate Only</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID123456789"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btc"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"deposit_action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aggregate"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Example: Convert and Withdraw (Lightning)</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID123456789"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btc"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"deposit_action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"convert_and_withdraw"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"target_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btc"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lightning_invoice"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lnbc100n1..."</span><span class="p">,</span><span class="w">
    </span><span class="nl">"max_slippage"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"webhook_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://merchant.com/webhooks/deposits"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"webhook_secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my_secret_key"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"webhook_protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hmac"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='webhook-payload-examples'>Webhook Payload Examples</h3>
<p>When a payment reference progresses through its lifecycle, webhook notifications are sent to your configured <code>webhook_url</code> with different event payloads. Below are the four event types and their payload structures.</p>

<hr>
<h4 id='event-1-deposit-matched'>Event 1: Deposit Matched</h4>
<p><strong>Event Name:</strong> <code>payment_reference.deposit_matched</code></p>

<p><strong>When Triggered:</strong> When a deposit is successfully linked to the payment reference</p>

<p><strong>Payload:</strong></p>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// Webhook Payload - POST to your webhook_url</span>
</code></pre></div><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"payment_reference.deposit_matched"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"payment_reference_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
  </span><span class="nl">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAY-ABC123"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID123456789"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"deposit_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span><span class="p">,</span><span class="w">
  </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100.00"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usd"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"deposit_blockchain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ethereum-erc20"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"txid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0xabc123def456..."</span><span class="p">,</span><span class="w">
  </span><span class="nl">"invoice"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lnbc1000u1..."</span><span class="p">,</span><span class="w">
  </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-01-17T10:00:00.000Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Field Notes:</strong></p>

<ul>
<li><code>invoice</code>: Only present for Lightning deposits</li>
<li><code>deposit_blockchain</code>: Blockchain key (e.g., &quot;bitcoin&quot;, &quot;ethereum-erc20&quot;, &quot;tron-trc20&quot;)</li>
</ul>

<hr>
<h4 id='event-2-completed'>Event 2: Completed</h4>
<p><strong>Event Name:</strong> <code>payment_reference.completed</code></p>

<p><strong>When Triggered:</strong> When all configured actions (aggregate, convert, withdraw) complete successfully</p>

<p><strong>Payload:</strong></p>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// Webhook Payload - POST to your webhook_url</span>
</code></pre></div><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"payment_reference.completed"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"payment_reference_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
  </span><span class="nl">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAY-ABC123"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID123456789"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"deposit_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span><span class="p">,</span><span class="w">
  </span><span class="nl">"internal_transfer_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">202</span><span class="p">,</span><span class="w">
  </span><span class="nl">"order_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">789</span><span class="p">,</span><span class="w">
  </span><span class="nl">"withdraw_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">101</span><span class="p">,</span><span class="w">
  </span><span class="nl">"deposit_blockchain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ethereum-erc20"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"invoice"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lnbc1000u1..."</span><span class="p">,</span><span class="w">
  </span><span class="nl">"withdraw_blockchain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bitcoin"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-01-17T10:05:00.000Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Field Notes (Conditional):</strong></p>

<ul>
<li><code>internal_transfer_id</code>: Only present if <code>deposit_action</code> was <code>aggregate</code> or <code>aggregate_convert_and_withdraw</code></li>
<li><code>order_id</code>: Only present if <code>deposit_action</code> included conversion (<code>convert_and_withdraw</code> or <code>aggregate_convert_and_withdraw</code>)</li>
<li><code>withdraw_id</code>: Only present if <code>deposit_action</code> included withdrawal</li>
<li><code>invoice</code>: Only present for Lightning deposits</li>
<li><code>withdraw_blockchain</code>: Only present if withdrawal occurred</li>
</ul>

<hr>
<h4 id='event-3-failed'>Event 3: Failed</h4>
<p><strong>Event Name:</strong> <code>payment_reference.failed</code></p>

<p><strong>When Triggered:</strong> When processing encounters a permanent failure</p>

<p><strong>Payload:</strong></p>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// Webhook Payload - POST to your webhook_url</span>
</code></pre></div><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"payment_reference.failed"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"payment_reference_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
  </span><span class="nl">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAY-ABC123"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID123456789"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"deposit_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span><span class="p">,</span><span class="w">
  </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Insufficient liquidity for market order on btcusd"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"deposit_blockchain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ethereum-erc20"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"invoice"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lnbc1000u1..."</span><span class="p">,</span><span class="w">
  </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-01-17T10:10:00.000Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Field Notes:</strong></p>

<ul>
<li><code>error</code>: Detailed error message describing the failure reason</li>
<li><code>invoice</code>: Only present for Lightning deposits</li>
</ul>

<hr>
<h4 id='event-4-duplicate-deposit'>Event 4: Duplicate Deposit</h4>
<p><strong>Event Name:</strong> <code>payment_reference.duplicate_deposit</code></p>

<p><strong>When Triggered:</strong> When a second deposit is received for a payment reference that already has a deposit linked</p>

<p><strong>Payload:</strong></p>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// Webhook Payload - POST to your webhook_url</span>
</code></pre></div><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"payment_reference.duplicate_deposit"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAY-ABC123"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"member_uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID123456789"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"currency_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usd"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100.00"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"original_deposit_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span><span class="p">,</span><span class="w">
  </span><span class="nl">"duplicate_deposit_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">789</span><span class="p">,</span><span class="w">
  </span><span class="nl">"duplicate_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-01-17T10:15:00.000Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Field Notes:</strong></p>

<ul>
<li><code>duplicate_count</code>: Number of duplicate deposits received (increments with each duplicate)</li>
<li>This event helps you track and handle unexpected duplicate payments from customers</li>
</ul>

<hr>
<h2 id='get-list-payment-references'><span class="request-type__get">GET</span> List payment references</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// listPaymentReferences.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com/api/v2/atlas/account/payments</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">listPaymentReferences</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">X-Auth-Apikey</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">your_api_key</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Nonce</span><span class="dl">"</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
    <span class="dl">"</span><span class="s2">X-Auth-Signature</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">your_generated_signature</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">get</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
    <span class="na">params</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">page</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">limit</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">listPaymentReferences</span><span class="p">();</span>
</code></pre></div>
<p><code>/api/v2/account/payments</code></p>
<h3 id='description-45'>Description</h3>
<p>List all payment references for your customer accounts. Returns paginated results.</p>

<p><strong>Access:</strong> Merchants and Aggregators only</p>

<p><strong>Acting as a Customer:</strong> Provide <code>uid</code> parameter to list payment references for that customer sub-account. The customer must belong to your merchant account.</p>

<hr>
<h3 id='parameters-41'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>uid</td>
<td>query</td>
<td>Customer sub-account UID</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>page</td>
<td>query</td>
<td>Page number (default: 1)</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>limit</td>
<td>query</td>
<td>Results per page (max: 100)</td>
<td>No</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='responses-45'>Responses</h3>
<p><strong>Headers:</strong></p>

<table><thead>
<tr>
<th>Header</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Total</td>
<td>Total number of records</td>
</tr>
<tr>
<td>Page</td>
<td>Current page number</td>
</tr>
<tr>
<td>Per-Page</td>
<td>Records returned per page</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Payment references retrieved</td>
<td>Array of PaymentReference</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden (not merchant/aggregator)</td>
<td>Error array</td>
</tr>
<tr>
<td>422</td>
<td>Validation error</td>
<td>Error array</td>
</tr>
</tbody></table>

<p><strong>Example Response:</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
    </span><span class="nl">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAY-ABC123"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID123456789"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btc"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"deposit_action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"convert_and_withdraw"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"target_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zar"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"beneficiary_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span><span class="p">,</span><span class="w">
      </span><span class="nl">"max_slippage"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pending_deposit"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"webhook_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://merchant.com/webhooks/deposits"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-15T10:30:00Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-15T10:30:00Z"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div><h2 id='get-get-payment-reference-by-id'><span class="request-type__get">GET</span> Get payment reference by id</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// showPaymentReference.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">paymentId</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`https://trade.capecrypto.com/api/v2/atlas/account/payments/</span><span class="p">${</span><span class="nx">paymentId</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">showPaymentReference</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">X-Auth-Apikey</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">your_api_key</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Nonce</span><span class="dl">"</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
    <span class="dl">"</span><span class="s2">X-Auth-Signature</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">your_generated_signature</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">get</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
    <span class="na">params</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">includeSecret</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// Optional: include webhook secret</span>
    <span class="p">},</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">showPaymentReference</span><span class="p">();</span>
</code></pre></div>
<p><code>/api/v2/account/payments/:id</code></p>
<h3 id='description-46'>Description</h3>
<p>Retrieve details of a specific payment reference.</p>

<p><strong>Access:</strong> Merchants and Aggregators only</p>

<hr>
<h3 id='parameters-42'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>path</td>
<td>Payment reference ID</td>
<td>Yes</td>
<td>integer</td>
</tr>
<tr>
<td>includeSecret</td>
<td>query</td>
<td>Include webhook secret in response (default: false)</td>
<td>No</td>
<td>boolean</td>
</tr>
</tbody></table>
<h3 id='responses-46'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Payment reference retrieved</td>
<td>PaymentReference</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden (not merchant/aggregator)</td>
<td>Error array</td>
</tr>
<tr>
<td>404</td>
<td>Payment reference not found</td>
<td>Error array</td>
</tr>
</tbody></table>

<p><strong>Example Response (with includeSecret=true):</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
  </span><span class="nl">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PAY-ABC123"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID123456789"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btc"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"deposit_action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aggregate_convert_and_withdraw"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"target_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"beneficiary_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lightning_invoice"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"max_slippage"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"completed"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"webhook_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://merchant.com/webhooks/deposits"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"webhook_secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"wh_secret_abc123xyz"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"webhook_protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hmac"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"deposit_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">789</span><span class="p">,</span><span class="w">
  </span><span class="nl">"order_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1011</span><span class="p">,</span><span class="w">
  </span><span class="nl">"withdraw_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1213</span><span class="p">,</span><span class="w">
  </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-15T10:30:00Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-15T14:45:00Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h1 id='merchant-management-aggregators-only'>Merchant Management (Aggregators Only)</h1>
<p><strong>Note:</strong> These endpoints are only available for <strong>Aggregators</strong> to manage their merchant accounts.</p>
<h2 id='get-list-merchants'><span class="request-type__get">GET</span> List Merchants</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// listMerchants.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">listMerchants</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/persona/resource/merchants?page=1&amp;limit=100`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">listMerchants</span><span class="p">();</span>
</code></pre></div>
<p><code>/persona/resource/merchants</code></p>
<h3 id='description-47'>Description</h3>
<p>Get a paginated list of merchant accounts managed by the aggregator.</p>
<h3 id='parameters-43'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>page</td>
<td>query</td>
<td>Page number (defaults to 1)</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>limit</td>
<td>query</td>
<td>Number of results per page (default: 100, max: 1000)</td>
<td>No</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='responses-47'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>List of merchants with pagination</td>
<td>Array of merchants (see <a href="#customer-business">Customer (Business)</a>)</td>
</tr>
</tbody></table>

<p><strong>Note:</strong> Pagination information is returned in HTTP headers (<code>Page</code>, <code>Per-Page</code>, <code>Total</code>), not in the response body.</p>
<h2 id='get-list-merchant-39-s-customers'><span class="request-type__get">GET</span> List Merchant&#39;s Customers</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// listMerchantCustomers.js</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">axios</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generateHeaders</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./generateHeaders</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">listMerchantCustomers</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://trade.capecrypto.com</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">merchantUid</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">ID987654321XYZ</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/api/v2/persona/resource/merchants/</span><span class="p">${</span><span class="nx">merchantUid</span><span class="p">}</span><span class="s2">/customers?page=1&amp;limit=100`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">headers</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">axiosConfig</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">listMerchantCustomers</span><span class="p">();</span>
</code></pre></div>
<p><code>/persona/resource/merchants/{uid}/customers</code></p>
<h3 id='description-48'>Description</h3>
<p>Get a paginated list of customers belonging to a specific merchant. This provides a nested view for aggregators to see which customers belong to which merchant.</p>
<h3 id='parameters-44'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>uid</td>
<td>path</td>
<td>Merchant identifier</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>page</td>
<td>query</td>
<td>Page number (defaults to 1)</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>limit</td>
<td>query</td>
<td>Number of results per page (default: 100, max: 1000)</td>
<td>No</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='responses-48'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>List of merchant&#39;s customers with pagination</td>
<td>[ <a href="#customer">Customer</a> ]</td>
</tr>
<tr>
<td>404</td>
<td>Merchant not found</td>
<td>Error array</td>
</tr>
</tbody></table>

<p><strong>Note:</strong> Pagination information is returned in HTTP headers (<code>Page</code>, <code>Per-Page</code>, <code>Total</code>), not in the response body.</p>
<h1 id='trading'>Trading</h1><h2 id='post-create-order-2'><span class="request-type__post">POST</span> Create Order</h2>
<p><code>/market/orders</code></p>
<h3 id='description-49'>Description</h3>
<p>Submits a Buy/Sell order to the order book. Orders should be confirmed that they have been created either by querying the order ID that is returned in the response, or subscribing to the websockets for order updates.</p>

<p>You can supply your own custom_order_id for tracking purposes for you own system.</p>

<p>For limit orders, you can specify post_only to ensure that orders wont complete if they would have matched. The order request will fail if post_only is true, and the order would have matched.</p>
<h3 id='parameters-45'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>market</td>
<td>The market name eg &#39;btczar&#39;</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>side</td>
<td>The direction of the order eg buy</td>
<td>Yes</td>
<td>string</td>
</tr>
<tr>
<td>volume</td>
<td>The order size in base currency</td>
<td>Yes</td>
<td>double</td>
</tr>
<tr>
<td>ord_type</td>
<td>Limit / Market</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>price</td>
<td>The limit order price</td>
<td>No</td>
<td>double</td>
</tr>
<tr>
<td>post_only</td>
<td>Fail limit order if matched</td>
<td>No</td>
<td>boolean</td>
</tr>
<tr>
<td>custom_order_id</td>
<td>Your custom order id</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-49'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>201</td>
<td>Order submitted</td>
<td><a href="#order">Order</a></td>
</tr>
</tbody></table>
<h2 id='get-order-by-id'><span class="request-type__get">GET</span> Order by id</h2>
<p><code>/market/orders/{id}</code></p>
<h3 id='description-50'>Description</h3>
<p>Get single order details.</p>
<h3 id='parameters-46'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>path</td>
<td></td>
<td>Yes</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-50'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Order details.</td>
<td><a href="#order">Order</a></td>
</tr>
</tbody></table>
<h2 id='get-all-orders'><span class="request-type__post">GET</span> All orders</h2>
<p><code>/market/orders</code></p>
<h3 id='description-51'>Description</h3>
<p>Get orders, result is paginated.</p>
<h3 id='parameters-47'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>market</td>
<td>query</td>
<td></td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>base_unit</td>
<td>query</td>
<td></td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>quote_unit</td>
<td>query</td>
<td></td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>state</td>
<td>query</td>
<td>Filter order by state.</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>limit</td>
<td>query</td>
<td>Limit the number of returned orders, default to 100.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>page</td>
<td>query</td>
<td>Paginated page number.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>order_by</td>
<td>query</td>
<td>If set, returned orders will be sorted in specific order, default to &quot;desc&quot;.</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>ord_type</td>
<td>query</td>
<td>Filter order by ord_type.</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>type</td>
<td>query</td>
<td>Filter order by type.</td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>time_from</td>
<td>query</td>
<td>Timestamp in ms.If set, only orders created after the time will be returned.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>time_to</td>
<td>query</td>
<td>Timestamp in ms.If set, only orders created before the time will be returned.</td>
<td>No</td>
<td>integer</td>
</tr>
</tbody></table>
<h3 id='responses-51'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Get your orders, result is paginated.</td>
<td>[ <a href="#order">Order</a> ]</td>
</tr>
</tbody></table>
<h2 id='get-trades'><span class="request-type__get">GET</span> Trades</h2>
<p><code>/market/trades</code></p>
<h3 id='description-52'>Description</h3>
<p>Fetch your trades executed on your orders.</p>
<h3 id='parameters-48'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>market</td>
<td>query</td>
<td></td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>order_id</td>
<td>query</td>
<td>Get the trades for a specific order_id</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>limit</td>
<td>query</td>
<td>Limit the number of returned trades. Default to 100.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>page</td>
<td>query</td>
<td>Paginated page number.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>time_from</td>
<td>query</td>
<td>Timestamp in ms. Return trades executed after the timestamp.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>time_to</td>
<td>query</td>
<td>Timestamp in ms. Return trades executed after the timestamp.</td>
<td>No</td>
<td>integer</td>
</tr>
<tr>
<td>order_by</td>
<td>query</td>
<td>Order by created_at, defaults to &#39;desc&#39;. [asc desc]</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-52'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Get your executed trades..</td>
<td>[ <a href="#trade">Trade</a> ]</td>
</tr>
</tbody></table>
<h2 id='post-cancel-order'><span class="request-type__post">POST</span> Cancel Order</h2>
<p><code>/market/orders/{id}/cancel</code></p>
<h3 id='description-53'>Description</h3>
<p>Cancel a specific order by Order id.</p>
<h3 id='parameters-49'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>path</td>
<td></td>
<td>Yes</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-53'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>201</td>
<td>Cancel an order.</td>
</tr>
</tbody></table>
<h2 id='post-cancel-all-orders'><span class="request-type__post">POST</span> Cancel All Orders</h2>
<p><code>/market/orders/cancel</code></p>
<h3 id='description-54'>Description</h3>
<p>Cancel all of your open orders.</p>
<h3 id='parameters-50'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>market</td>
<td>formData</td>
<td></td>
<td>No</td>
<td>string</td>
</tr>
<tr>
<td>side</td>
<td>formData</td>
<td>Only cancel orders on this side [buy sell]</td>
<td>No</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-54'>Responses</h3>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>201</td>
<td>Cancel all my orders.</td>
<td><a href="#order">Order</a></td>
</tr>
</tbody></table>
<h1 id='websocket'>Websocket</h1><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// generateHeaders.js</span>

<span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">apiKey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">123456...</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">ABCDEF...</span><span class="dl">"</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">timeStamp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">queryString</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">timeStamp</span><span class="p">}${</span><span class="nx">apikey</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">crypto</span>
    <span class="p">.</span><span class="nx">createHmac</span><span class="p">(</span><span class="dl">"</span><span class="s2">sha256</span><span class="dl">"</span><span class="p">,</span> <span class="nx">secret</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">queryString</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json;charset=utf-8</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Apikey</span><span class="dl">"</span><span class="p">:</span> <span class="nx">apikey</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Nonce</span><span class="dl">"</span><span class="p">:</span> <span class="nx">timeStamp</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Auth-Signature</span><span class="dl">"</span><span class="p">:</span> <span class="nx">signature</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">};</span>
</code></pre></div>
<p>The high performance websocket provides near realtime updates on the orderbook, your orders and balances.</p>

<p>The orderbook endpoint does not require authenticaiton, while the private endpoints (orders, trades, and balances) do require authentication.</p>

<p>To connect to the private endpoints on the websocket, send the authentication headers with the connection request, similar to the REST authentication, and subscribe to the streams you are interested in.
You can combine multiple subscriptions in one request, and also provide the subscriptions at the same time as connecting - ie. you only need 1x request to get fully connected.</p>

<p>You can also combine the public and private streams into one so that you only need to maintain 1x connection for example <code>?stream=btczar.ob-inc&amp;stream=order&amp;stream=trade&amp;stream=balance</code></p>
<h2 id='subscribe-orderbook'><span class="request-type__get">SUBSCRIBE</span> Orderbook</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">const</span> <span class="nx">WebSocket</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">ws</span><span class="dl">"</span><span class="p">);</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">connectWssPublic</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="s2">`wss://trade.capecrypto.com/api/v2`</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">streams</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">?stream=btczar.ob-inc&amp;stream=ethzar.ob-inc</span><span class="dl">"</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/websocket/public</span><span class="p">${</span><span class="nx">streams</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

    <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">open</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Connected to websocket</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">message</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">([</span><span class="dl">"</span><span class="s2">ob-snap</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ob-inc</span><span class="dl">"</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// handle all subscribed markets</span>
      <span class="c1">// updateOrderBook(data);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">connectWssPublic</span><span class="p">();</span>
</code></pre></div>
<p><code>?stream={market}.ob-inc</code></p>
<h3 id='description-55'>Description</h3>
<p>Subscribe to orderbook updates for the specified market. You can subscribe to multiple markets at the same time by adding each market as a param, eg</p>

<p><code>?stream=btczar.ob-inc&amp;ethzar.ob-inc</code></p>

<p>Note: if the amount is empty &quot;&quot;, the order has been removed from the orderbook</p>
<h3 id='parameters-51'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>{market}-ob.inc</td>
<td>query</td>
<td>Name of the market to subscribe to</td>
<td>yes</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-55'>Responses</h3>
<table><thead>
<tr>
<th>Description</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>snapshot</td>
<td>[ <a href="#websocket-orderbook-snapshot">Snapshot</a> ]</td>
</tr>
<tr>
<td>increment</td>
<td>[ <a href="#websocket-orderbook-increment">Increment</a> ]</td>
</tr>
</tbody></table>
<h2 id='subscribe-k-line'><span class="request-type__get">SUBSCRIBE</span> K-Line</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">const</span> <span class="nx">WebSocket</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">ws</span><span class="dl">"</span><span class="p">);</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">connectWssPublic</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="s2">`wss://trade.capecrypto.com/api/v2`</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">streams</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">?stream=btczar.kline-15m</span><span class="dl">"</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/websocket/public</span><span class="p">${</span><span class="nx">streams</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

    <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">open</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Connected to websocket</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">message</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">([</span><span class="dl">"</span><span class="s2">kline-</span><span class="dl">"</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// handle all subscribed markets</span>
      <span class="c1">// updateOrderBook(data);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">connectWssPublic</span><span class="p">();</span>
</code></pre></div>
<p><code>?stream={market}.kline-{period}</code></p>
<h3 id='description-56'>Description</h3>
<p>Subscribe to the K-LINE (OHLC) for the specified market to get updates on the OHLC for each period. Similary to the otherendpoints, you can combine streams into a single subscription request.</p>
<h3 id='parameters-52'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Located in</th>
<th>Description</th>
<th>Required</th>
<th>Schema</th>
</tr>
</thead><tbody>
<tr>
<td>{market}</td>
<td>query</td>
<td>Name of the market to subscribe to</td>
<td>yes</td>
<td>string</td>
</tr>
<tr>
<td>{period}</td>
<td>query</td>
<td>The period to get updates at &quot;1m&quot;, &quot;5m&quot;, &quot;15m&quot;, &quot;30m&quot;, &quot;1h&quot;, &quot;2h&quot;, &quot;4h&quot;, &quot;6h&quot;, &quot;12h&quot;, &quot;1d&quot;, &quot;3d&quot;, &quot;1w&quot;</td>
<td>yes</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='responses-56'>Responses</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>{market}.kline-{period}</td>
<td>object</td>
<td>Key name of the OHLC for the market and period</td>
</tr>
<tr>
<td>OHLC for that period</td>
<td>[number]</td>
<td>Array of Timestamp, Open, High, Low, Close, Volume</td>
</tr>
</tbody></table>
<h2 id='subscribe-private'><span class="request-type__get">SUBSCRIBE</span> Private</h2><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">connectWssPrivate</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="s2">`wss://trade.capecrypto.com/api/v2`</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateHeaders</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">streams</span> <span class="o">=</span>
      <span class="dl">"</span><span class="s2">?stream=btczar.ob-inc&amp;stream=ethzar.ob-inc&amp;stream=order&amp;stream=trade&amp;stream=balance</span><span class="dl">"</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">`/websocket/private</span><span class="p">${</span><span class="nx">streams</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

    <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="p">{</span> <span class="nx">headers</span> <span class="p">});</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">open</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Connected to websocket</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="dl">"</span><span class="s2">xrpzar.ob-snap</span><span class="dl">"</span><span class="p">]</span> <span class="o">||</span> <span class="nx">data</span><span class="p">[</span><span class="dl">"</span><span class="s2">xrpzar.ob-inc</span><span class="dl">"</span><span class="p">])</span> <span class="p">{</span>
      <span class="c1">// handle orderbook updates for subscribed markets</span>
      <span class="c1">// updateOrderBook(data);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="dl">"</span><span class="s2">order</span><span class="dl">"</span><span class="p">])</span> <span class="p">{</span>
      <span class="c1">// handleOwnOrderUpdate(data);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="dl">"</span><span class="s2">trade</span><span class="dl">"</span><span class="p">])</span> <span class="p">{</span>
      <span class="c1">// handleOwnTradeUpdate(data);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="dl">"</span><span class="s2">balance</span><span class="dl">"</span><span class="p">])</span> <span class="p">{</span>
      <span class="c1">// handleBalanceUpdate(data);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">connectWssPrivate</span><span class="p">();</span>
</code></pre></div>
<p>Subscribe to your account and receive real-time updates on your orders, trades, and balances.</p>

<p><strong>Important:</strong> You can subscribe to ALL streams (both public and private) in a single WebSocket connection using the <code>/websocket/private</code> endpoint. This is the recommended approach as it minimizes connection overhead and provides a unified stream of all market events.</p>

<p><strong>Private streams only:</strong></p>

<p><code>?stream=order&amp;stream=trade&amp;stream=balance</code></p>

<p><strong>Combining public orderbook + private streams (recommended):</strong></p>

<p><code>?stream=btczar.ob-inc&amp;stream=order&amp;stream=trade&amp;stream=balance</code></p>

<p><strong>Benefits of combining streams:</strong></p>

<ul>
<li>Single WebSocket connection for all updates</li>
<li>Synchronized view of orderbook changes and your order executions</li>
<li>Real-time balance updates as trades execute</li>
<li>Reduced latency and connection overhead</li>
</ul>
<h3 id='order-stream'>Order Stream</h3>
<p><strong>Subscription:</strong> <code>?stream=order</code></p>

<p>Receive real-time updates when your orders are created, updated, filled, or canceled.</p>

<p><strong>Response Format:</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"order"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">173757</span><span class="p">,</span><span class="w">
    </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7e86a4fa-fcae-4953-b9bc-d6f328beea48"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"side"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sell"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ord_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"limit"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="s2">"800000.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"avg_price"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"wait"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"market"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btczar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2023-12-08T08:46:59+01:00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2023-12-08T08:46:59+01:00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"origin_volume"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.00001"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"remaining_volume"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.00001"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"executed_volume"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"trades_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Order Update Triggers:</strong></p>

<ul>
<li>Order created and accepted</li>
<li>Order partially filled</li>
<li>Order fully filled (state changes to &quot;done&quot;)</li>
<li>Order canceled</li>
<li>Order rejected</li>
</ul>
<h3 id='trade-stream'>Trade Stream</h3>
<p><strong>Subscription:</strong> <code>?stream=trade</code></p>

<p>Receive real-time updates when your orders are matched and trades are executed.</p>

<p><strong>Response Format:</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"trade"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">12345</span><span class="p">,</span><span class="w">
    </span><span class="nl">"order_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">173757</span><span class="p">,</span><span class="w">
    </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="s2">"800000.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.00001"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"market"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btczar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"side"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sell"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"taker_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"buy"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fee_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fee"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.002"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fee_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.016"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2023-12-08T08:47:01+01:00"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Trade Event Triggers:</strong></p>

<ul>
<li>Your limit order is matched (you are the maker)</li>
<li>Your market order is executed (you are the taker)</li>
<li>Your order is partially filled</li>
</ul>
<h3 id='balance-stream'>Balance Stream</h3>
<p><strong>Subscription:</strong> <code>?stream=balance</code></p>

<p>Receive real-time updates when your account balances change. Balance updates are triggered by trading activity, order placement, and order cancellation.</p>

<p><strong>Response Format:</strong></p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btc"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.05000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"locked"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.00001000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"available"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.04999000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="mi">1702027621000</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Response Fields:</strong></p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>currency</td>
<td>string</td>
<td>Currency code (btc, eth, zar, usdt, etc.)</td>
</tr>
<tr>
<td>balance</td>
<td>string</td>
<td>Total balance (available + locked). String for decimal precision</td>
</tr>
<tr>
<td>locked</td>
<td>string</td>
<td>Amount currently locked in open orders</td>
</tr>
<tr>
<td>available</td>
<td>string</td>
<td>Available balance for trading (balance - locked)</td>
</tr>
<tr>
<td>updated_at</td>
<td>integer</td>
<td>Unix timestamp in milliseconds when balance was updated</td>
</tr>
</tbody></table>

<p><strong>Balance Update Triggers:</strong></p>

<ol>
<li><strong>Order Creation</strong> - Locks balance when a limit or market order is placed</li>
<li><strong>Order Cancellation</strong> - Unlocks balance when an order is canceled</li>
<li><strong>Trade Execution (Maker)</strong> - Updates both base and quote currency balances</li>
<li><strong>Trade Execution (Taker)</strong> - Updates both base and quote currency balances with fee deduction</li>
<li><strong>Partial Fill</strong> - Each partial fill triggers separate balance updates</li>
<li><strong>Order Rejection</strong> - Balance unlock if order validation fails after initial lock</li>
</ol>

<p><strong>Example 1: Order Creation (Balance Lock)</strong></p>

<p>When you place a buy order for 0.001 BTC @ 800,000 ZAR, your ZAR balance is locked:</p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10000.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"locked"</span><span class="p">:</span><span class="w"> </span><span class="s2">"800.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"available"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9200.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="mi">1702027621000</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Example 2: Order Cancellation (Balance Unlock)</strong></p>

<p>When you cancel the order, the locked ZAR is released:</p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10000.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"locked"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"available"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10000.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="mi">1702027625000</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Example 3: Trade Execution - Sell Order (Base Currency)</strong></p>

<p>When your sell order for 0.00001 BTC executes, you receive two balance updates. First, the BTC is deducted:</p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btc"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.04999000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"locked"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.00000000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"available"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.04999000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="mi">1702027630000</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Example 4: Trade Execution - Sell Order (Quote Currency)</strong></p>

<p>Immediately after, you receive ZAR (minus the taker fee of 0.2%):</p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10007.984"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"locked"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"available"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10007.984"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="mi">1702027630001</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Example 5: Partial Fill</strong></p>

<p>When your order is partially filled (50% of 0.001 BTC order):</p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btc"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.04999500"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"locked"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.00000500"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"available"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.04999000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="mi">1702027635000</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>Important Notes:</strong></p>

<ul>
<li><strong>Atomic Updates</strong>: Balance updates are atomic - you receive one update per currency per event</li>
<li><strong>Dual Updates for Trades</strong>: For each trade, expect <strong>two balance updates</strong> - one for the base currency and one for the quote currency</li>
<li><strong>Timestamp Precision</strong>: The <code>updated_at</code> field uses <strong>Unix milliseconds</strong> (not seconds)</li>
<li><strong>String Values</strong>: Balance values are strings to preserve decimal precision - parse them as decimals, not floats</li>
<li><strong>Rapid Updates</strong>: Multiple rapid trades may result in several balance updates in quick succession</li>
<li><strong>Fee Inclusion</strong>: Fees are already deducted from the amounts shown in balance updates</li>
</ul>

<p><strong>Edge Cases:</strong></p>

<ul>
<li><strong>Insufficient Funds</strong>: No balance update is sent (order is rejected before locking funds)</li>
<li><strong>Self-Trade Prevention</strong>: If a self-trade is prevented, balance may lock and then immediately unlock</li>
<li><strong>Partial Fills</strong>: Each partial fill of an order triggers separate balance updates for both currencies</li>
<li><strong>Maker vs Taker Fees</strong>: Fee amounts differ based on whether you&#39;re the maker (0.1%) or taker (0.2%)</li>
</ul>

<p><strong>Integration Example:</strong></p>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="dl">"</span><span class="s2">balance</span><span class="dl">"</span><span class="p">])</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">currency</span><span class="p">,</span> <span class="nx">balance</span><span class="p">,</span> <span class="nx">locked</span><span class="p">,</span> <span class="nx">available</span><span class="p">,</span> <span class="nx">updated_at</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">balance</span><span class="p">;</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Balance Update: </span><span class="p">${</span><span class="nx">currency</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`  Total: </span><span class="p">${</span><span class="nx">balance</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`  Locked: </span><span class="p">${</span><span class="nx">locked</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`  Available: </span><span class="p">${</span><span class="nx">available</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`  Updated: </span><span class="p">${</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">updated_at</span><span class="p">).</span><span class="nx">toISOString</span><span class="p">()}</span><span class="s2">`</span><span class="p">);</span>

    <span class="c1">// Update your UI</span>
    <span class="nx">updateBalanceDisplay</span><span class="p">(</span><span class="nx">currency</span><span class="p">,</span> <span class="nx">available</span><span class="p">,</span> <span class="nx">locked</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="dl">"</span><span class="s2">order</span><span class="dl">"</span><span class="p">])</span> <span class="p">{</span>
    <span class="c1">// Handle order updates</span>
    <span class="nx">handleOrderUpdate</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">order</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="dl">"</span><span class="s2">trade</span><span class="dl">"</span><span class="p">])</span> <span class="p">{</span>
    <span class="c1">// Handle trade updates - expect balance updates to follow immediately</span>
    <span class="nx">handleTradeUpdate</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">trade</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div><h1 id='models'>Models</h1><h3 id='pagination'>Pagination</h3>
<p>All paginated list endpoints return an array of items in the response body, with pagination information provided in HTTP response headers:</p>

<table><thead>
<tr>
<th>Header</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead><tbody>
<tr>
<td>Page</td>
<td>Current page number</td>
<td>1</td>
</tr>
<tr>
<td>Per-Page</td>
<td>Number of items per page</td>
<td>100</td>
</tr>
<tr>
<td>Total</td>
<td>Total number of items across all pages</td>
<td>150</td>
</tr>
</tbody></table>
<h3 id='ticker'>Ticker</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>at</td>
<td>integer</td>
<td>Timestamp of ticker</td>
</tr>
<tr>
<td>ticker</td>
<td><a href="#tickerentry">TickerEntry</a></td>
<td>Ticker entry for specified time</td>
</tr>
</tbody></table>
<h3 id='tickerentry'>TickerEntry</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>low</td>
<td>double</td>
<td>The lowest trade price during last 24 hours (0.0 if no trades executed during last 24 hours)</td>
</tr>
<tr>
<td>high</td>
<td>double</td>
<td>The highest trade price during last 24 hours (0.0 if no trades executed during last 24 hours)</td>
</tr>
<tr>
<td>open</td>
<td>double</td>
<td>Price of the first trade executed 24 hours ago or less</td>
</tr>
<tr>
<td>last</td>
<td>double</td>
<td>The last executed trade price</td>
</tr>
<tr>
<td>volume</td>
<td>double</td>
<td>Total volume of trades executed during last 24 hours</td>
</tr>
<tr>
<td>amount</td>
<td>double</td>
<td>Total amount of trades executed during last 24 hours</td>
</tr>
<tr>
<td>vol</td>
<td>double</td>
<td>Alias to volume</td>
</tr>
<tr>
<td>avg_price</td>
<td>double</td>
<td>Average price more precisely VWAP (volume weighted average price)</td>
</tr>
<tr>
<td>price_change_percent</td>
<td>string</td>
<td>Price change over the last 24 hours</td>
</tr>
<tr>
<td>at</td>
<td>integer</td>
<td>Timestamp of ticker</td>
</tr>
</tbody></table>
<h3 id='orderbook-entry'>Orderbook entry</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>price</td>
<td>number</td>
<td>The price of the order</td>
</tr>
<tr>
<td>amount</td>
<td>number</td>
<td>The amount of the order at that price. Note: if the amount is empty &quot;&quot;, the order has been removed from the orderbook</td>
</tr>
</tbody></table>
<h3 id='trade'>Trade</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>string</td>
<td>Trade ID.</td>
</tr>
<tr>
<td>price</td>
<td>double</td>
<td>Trade price.</td>
</tr>
<tr>
<td>amount</td>
<td>double</td>
<td>Trade amount.</td>
</tr>
<tr>
<td>total</td>
<td>double</td>
<td>Trade total (Amount * Price).</td>
</tr>
<tr>
<td>fee_currency</td>
<td>double</td>
<td>Currency user&#39;s fees were charged in.</td>
</tr>
<tr>
<td>fee</td>
<td>double</td>
<td>Percentage of fee user was charged for performed trade.</td>
</tr>
<tr>
<td>fee_amount</td>
<td>double</td>
<td>Amount of fee user was charged for performed trade.</td>
</tr>
<tr>
<td>market</td>
<td>string</td>
<td>Trade market id.</td>
</tr>
<tr>
<td>created_at</td>
<td>string</td>
<td>Trade create time in iso8601 format.</td>
</tr>
<tr>
<td>taker_type</td>
<td>string</td>
<td>Trade taker order type (sell or buy).</td>
</tr>
<tr>
<td>side</td>
<td>string</td>
<td>Trade side.</td>
</tr>
<tr>
<td>order_id</td>
<td>integer</td>
<td>Order id.</td>
</tr>
<tr>
<td>custom_order_id</td>
<td>integer</td>
<td>Optional custom Order id if supplied.</td>
</tr>
</tbody></table>
<h3 id='order'>Order</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>integer</td>
<td>Unique order id.</td>
</tr>
<tr>
<td>custom_order_id</td>
<td>string</td>
<td>Custom order id if supplied during order creation.</td>
</tr>
<tr>
<td>side</td>
<td>string</td>
<td>Either &#39;sell&#39; or &#39;buy&#39;.</td>
</tr>
<tr>
<td>ord_type</td>
<td>string</td>
<td>Type of order, either &#39;limit&#39; or &#39;market&#39;.</td>
</tr>
<tr>
<td>post_only</td>
<td>boolean</td>
<td>If the Limit order was submitted as post_only .</td>
</tr>
<tr>
<td>price</td>
<td>double</td>
<td>Price for 1x base unit.</td>
</tr>
<tr>
<td>avg_price</td>
<td>double</td>
<td>Average execution price over all executed trades.</td>
</tr>
<tr>
<td>state</td>
<td>string</td>
<td>Current state of the order <a href="#states">Order states</a></td>
</tr>
<tr>
<td>market</td>
<td>string</td>
<td>The market in which the order is placed, e.g. &#39;btczar&#39;.</td>
</tr>
<tr>
<td>created_at</td>
<td>string</td>
<td>Order create time in iso8601 format.</td>
</tr>
<tr>
<td>updated_at</td>
<td>string</td>
<td>Order updated time in iso8601 format.</td>
</tr>
<tr>
<td>origin_volume</td>
<td>double</td>
<td>The original amount of the order.</td>
</tr>
<tr>
<td>remaining_volume</td>
<td>double</td>
<td>The remaining amount of the original order volume.</td>
</tr>
<tr>
<td>executed_volume</td>
<td>double</td>
<td>The executed volume of the original order volume.</td>
</tr>
<tr>
<td>trades_count</td>
<td>integer</td>
<td>Number of trades executed against this limit order.</td>
</tr>
<tr>
<td>trades</td>
<td>[<a href="#trade">Trade</a>]</td>
<td>Array of trades executed against this order.</td>
</tr>
</tbody></table>
<h3 id='market'>Market</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>string</td>
<td>Unique market id eg &#39;btczar&#39;</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Market name.</td>
</tr>
<tr>
<td>base_unit</td>
<td>string</td>
<td>Market Base unit.</td>
</tr>
<tr>
<td>quote_unit</td>
<td>string</td>
<td>Market Quote unit.</td>
</tr>
<tr>
<td>min_price</td>
<td>double</td>
<td>Minimum order price.</td>
</tr>
<tr>
<td>max_price</td>
<td>double</td>
<td>Maximum order price.</td>
</tr>
<tr>
<td>min_amount</td>
<td>double</td>
<td>Minimum order amount.</td>
</tr>
<tr>
<td>amount_precision</td>
<td>double</td>
<td>Precision for order amount.</td>
</tr>
<tr>
<td>price_precision</td>
<td>double</td>
<td>Precision for order price.</td>
</tr>
<tr>
<td>state</td>
<td>string</td>
<td>If the market is enabled for trading or not.</td>
</tr>
</tbody></table>
<h3 id='currency'>Currency</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>string</td>
<td>Currency code.</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Currency name</td>
</tr>
<tr>
<td>symbol</td>
<td>string</td>
<td>Currency symbol</td>
</tr>
<tr>
<td>explorer_transaction</td>
<td>string</td>
<td>Currency transaction exprorer url template</td>
</tr>
<tr>
<td>explorer_address</td>
<td>string</td>
<td>Currency address exprorer url template</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>Currency type</td>
</tr>
<tr>
<td>deposit_enabled</td>
<td>string</td>
<td>Currency deposit possibility status (true/false).</td>
</tr>
<tr>
<td>withdrawal_enabled</td>
<td>string</td>
<td>Currency withdrawal possibility status (true/false).</td>
</tr>
<tr>
<td>deposit_fee</td>
<td>string</td>
<td>Currency deposit fee</td>
</tr>
<tr>
<td>min_deposit_amount</td>
<td>string</td>
<td>Minimal deposit amount</td>
</tr>
<tr>
<td>withdraw_fee</td>
<td>string</td>
<td>Currency withdraw fee</td>
</tr>
<tr>
<td>min_withdraw_amount</td>
<td>string</td>
<td>Minimal withdraw amount</td>
</tr>
<tr>
<td>withdraw_limit_24h</td>
<td>string</td>
<td>Currency 24h withdraw limit</td>
</tr>
<tr>
<td>withdraw_limit_72h</td>
<td>string</td>
<td>Currency 72h withdraw limit</td>
</tr>
<tr>
<td>base_factor</td>
<td>string</td>
<td>Currency base factor</td>
</tr>
<tr>
<td>precision</td>
<td>string</td>
<td>Currency precision</td>
</tr>
<tr>
<td>position</td>
<td>string</td>
<td>Position used for defining currencies order</td>
</tr>
<tr>
<td>icon_url</td>
<td>string</td>
<td>Currency icon</td>
</tr>
<tr>
<td>min_confirmations</td>
<td>string</td>
<td>Number of confirmations required for confirming deposit or withdrawal</td>
</tr>
<tr>
<td>layer_two_withdraw_fee</td>
<td>string</td>
<td>(Layer two dependant) The base layer two withdraw fee</td>
</tr>
<tr>
<td>layer_two_max_deposit_amount</td>
<td>string</td>
<td>(Layer two dependant) The maximum deposit amount</td>
</tr>
<tr>
<td>layer_two_max_withdraw_amount</td>
<td>string</td>
<td>(Layer two dependant) The maxumum withdrawal amount</td>
</tr>
</tbody></table>
<h3 id='withdraw'>Withdraw</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>integer</td>
<td>The withdrawal id.</td>
</tr>
<tr>
<td>currency</td>
<td>string</td>
<td>The currency code.</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>The withdrawal type</td>
</tr>
<tr>
<td>amount</td>
<td>string</td>
<td>The withdrawal amount</td>
</tr>
<tr>
<td>fee</td>
<td>double</td>
<td>The exchange fee.</td>
</tr>
<tr>
<td>blockchain_txid</td>
<td>string</td>
<td>The withdrawal transaction id.</td>
</tr>
<tr>
<td>rid</td>
<td>string</td>
<td>The beneficiary ID or wallet address on the Blockchain.</td>
</tr>
<tr>
<td>state</td>
<td>string</td>
<td>The withdrawal state.</td>
</tr>
<tr>
<td>confirmations</td>
<td>integer</td>
<td>Number of confirmations.</td>
</tr>
<tr>
<td>note</td>
<td>string</td>
<td>Optional withdraw note.</td>
</tr>
<tr>
<td>created_at</td>
<td>string</td>
<td>The datetime for the withdrawal.</td>
</tr>
<tr>
<td>updated_at</td>
<td>string</td>
<td>The datetime for the withdrawal.</td>
</tr>
<tr>
<td>done_at</td>
<td>string</td>
<td>The datetime when withdraw was completed</td>
</tr>
</tbody></table>
<h3 id='withdraw-quote'>Withdraw quote</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>string</td>
<td>The id of the quote. Submit this with your withdrawal request</td>
</tr>
<tr>
<td>currency</td>
<td>string</td>
<td>The currency code.</td>
</tr>
<tr>
<td>fee</td>
<td>string</td>
<td>The fee for the withdrawal</td>
</tr>
<tr>
<td>blockchain</td>
<td>string</td>
<td>The blockchain for this quote</td>
</tr>
<tr>
<td>created_at</td>
<td>string</td>
<td>The datetime the quote was created.</td>
</tr>
<tr>
<td>expires_at</td>
<td>string</td>
<td>The datetime the quote expires.</td>
</tr>
</tbody></table>
<h3 id='beneficiary'>Beneficiary</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>uuid</td>
<td>integer</td>
<td>Beneficiary Identifier</td>
</tr>
<tr>
<td>currency</td>
<td>string</td>
<td>Beneficiary currency code.</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Name of the beneficiary.</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>A personal description of the beneficiary for your records.</td>
</tr>
<tr>
<td>data</td>
<td>json</td>
<td>Bank Account details for FIAT Beneficiary in JSON format. For crypto it&#39;s blockchain address and or tag, as well as the travel rule information</td>
</tr>
<tr>
<td>state</td>
<td>string</td>
<td>Pending, Active, Archived (0,1,2)</td>
</tr>
</tbody></table>
<h3 id='subaccount'>SubAccount</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>uid</td>
<td>string</td>
<td>Sub-account unique identifier</td>
</tr>
<tr>
<td>account_name</td>
<td>string</td>
<td>Display name for the sub-account</td>
</tr>
<tr>
<td>state</td>
<td>string</td>
<td>Account state (active, deleted)</td>
</tr>
<tr>
<td>deposit_action</td>
<td>string</td>
<td>Action for deposits: &#39;none&#39; (keep in sub-account) or &#39;transfer_to_parent&#39; (auto-transfer)</td>
</tr>
<tr>
<td>created_at</td>
<td>string</td>
<td>Timestamp when the sub-account was created in ISO 8601 format</td>
</tr>
</tbody></table>
<h3 id='customer'>Customer</h3>
<p>Customer accounts come in two types with different response structures:</p>

<ul>
<li><strong>Individual Customers</strong> - See <a href="#customer-individual">Customer (Individual)</a> for personal account structure</li>
<li><strong>Business Customers</strong> - See <a href="#customer-business">Customer (Business)</a> for business account structure</li>
</ul>
<h3 id='customer-individual'>Customer (Individual)</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>uid</td>
<td>string</td>
<td>Customer unique identifier</td>
</tr>
<tr>
<td>account_name</td>
<td>string</td>
<td>Display name for the customer (usually custom_id)</td>
</tr>
<tr>
<td>state</td>
<td>string</td>
<td>Account state (active, deleted)</td>
</tr>
<tr>
<td>custom_id</td>
<td>string</td>
<td>Custom identifier set by merchant/aggregator</td>
</tr>
<tr>
<td>external_verification_url</td>
<td>string</td>
<td>URL for external verification system</td>
</tr>
<tr>
<td>kyc_status</td>
<td>string</td>
<td>KYC verification status (verified, pending, rejected)</td>
</tr>
<tr>
<td>created_at</td>
<td>string</td>
<td>Timestamp when customer was created in ISO 8601 format</td>
</tr>
<tr>
<td>profile</td>
<td>object</td>
<td>Customer profile information (first_name, last_name, dob, address, etc.)</td>
</tr>
<tr>
<td>phone</td>
<td>object</td>
<td>Phone information (country, number, validated_at)</td>
</tr>
</tbody></table>
<h3 id='customer-business'>Customer (Business)</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>integer</td>
<td>Customer database ID</td>
</tr>
<tr>
<td>uid</td>
<td>string</td>
<td>Customer unique identifier</td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td>Business email address</td>
</tr>
<tr>
<td>role</td>
<td>string</td>
<td>Account role (customer)</td>
</tr>
<tr>
<td>entity_type</td>
<td>string</td>
<td>Entity type (business)</td>
</tr>
<tr>
<td>level</td>
<td>integer</td>
<td>Account level</td>
</tr>
<tr>
<td>state</td>
<td>string</td>
<td>Account state (active, pending, deleted)</td>
</tr>
<tr>
<td>custom_id</td>
<td>string</td>
<td>Custom identifier set by merchant/aggregator</td>
</tr>
<tr>
<td>business_profile</td>
<td>object</td>
<td>Business details (legal_name, trading_name, registration_number, tax_id, incorporation_date, business_type, industry, address, city, postcode, country, website)</td>
</tr>
<tr>
<td>ubos</td>
<td>array</td>
<td>Array of Ultimate Beneficial Owners with ownership details</td>
</tr>
<tr>
<td>created_at</td>
<td>string</td>
<td>Timestamp when customer was created in ISO 8601 format</td>
</tr>
<tr>
<td>updated_at</td>
<td>string</td>
<td>Timestamp when customer was last updated in ISO 8601 format</td>
</tr>
</tbody></table>
<h3 id='deposit'>Deposit</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>integer</td>
<td>Unique deposit id.</td>
</tr>
<tr>
<td>blockchain</td>
<td>string</td>
<td>Blockchain id.</td>
</tr>
<tr>
<td>currency</td>
<td>string</td>
<td>Deposit currency id.</td>
</tr>
<tr>
<td>amount</td>
<td>double</td>
<td>Deposit amount.</td>
</tr>
<tr>
<td>fee</td>
<td>double</td>
<td>Deposit fee.</td>
</tr>
<tr>
<td>txid</td>
<td>string</td>
<td>Deposit transaction id.</td>
</tr>
<tr>
<td>confirmations</td>
<td>integer</td>
<td>Number of deposit confirmations.</td>
</tr>
<tr>
<td>state</td>
<td>string</td>
<td>Deposit state.</td>
</tr>
<tr>
<td>created_at</td>
<td>string</td>
<td>The datetime when deposit was created.</td>
</tr>
<tr>
<td>completed_at</td>
<td>string</td>
<td>The datetime when deposit was completed..</td>
</tr>
<tr>
<td>tid</td>
<td>string</td>
<td>The shared transaction ID</td>
</tr>
</tbody></table>
<h3 id='transaction'>Transaction</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>integer</td>
<td>Unique transaction identifier</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>Transaction type (deposit, withdraw, internal_transfer, trade, referral, maker_reward)</td>
</tr>
<tr>
<td>reference_type</td>
<td>string</td>
<td>Related entity type (Deposit, Withdraw, Order, etc.)</td>
</tr>
<tr>
<td>reference_id</td>
<td>integer</td>
<td>Related entity ID</td>
</tr>
<tr>
<td>credit_currency</td>
<td>string</td>
<td>Currency received (if applicable)</td>
</tr>
<tr>
<td>credit_amount</td>
<td>decimal</td>
<td>Amount received</td>
</tr>
<tr>
<td>debit_currency</td>
<td>string</td>
<td>Currency sent (if applicable)</td>
</tr>
<tr>
<td>debit_amount</td>
<td>decimal</td>
<td>Amount sent</td>
</tr>
<tr>
<td>fee_currency</td>
<td>string</td>
<td>Fee currency</td>
</tr>
<tr>
<td>fee</td>
<td>decimal</td>
<td>Fee amount</td>
</tr>
<tr>
<td>blockchain_key</td>
<td>string</td>
<td>Blockchain identifier (for crypto transactions)</td>
</tr>
<tr>
<td>blockchain_name</td>
<td>string</td>
<td>Blockchain name</td>
</tr>
<tr>
<td>market_id</td>
<td>string</td>
<td>Market ID (for trades)</td>
</tr>
<tr>
<td>order_id</td>
<td>string</td>
<td>Order ID (for trades)</td>
</tr>
<tr>
<td>price</td>
<td>decimal</td>
<td>Trade price (for trades)</td>
</tr>
<tr>
<td>origin_volume</td>
<td>decimal</td>
<td>Original order volume (for trades)</td>
</tr>
<tr>
<td>payment_method_provider</td>
<td>string</td>
<td>Payment provider (for fiat transactions)</td>
</tr>
<tr>
<td>payment_method_name</td>
<td>string</td>
<td>Payment method name</td>
</tr>
<tr>
<td>payment_method_precision</td>
<td>integer</td>
<td>Decimal precision for payment method</td>
</tr>
<tr>
<td>payment_method_icon_url</td>
<td>string</td>
<td>Payment method icon URL</td>
</tr>
<tr>
<td>voucher_pin</td>
<td>string</td>
<td>Voucher PIN (if applicable)</td>
</tr>
<tr>
<td>change_voucher_pin</td>
<td>string</td>
<td>Change voucher PIN (if change was issued)</td>
</tr>
<tr>
<td>change_voucher_expiry</td>
<td>string</td>
<td>Change voucher expiry date (ISO8601)</td>
</tr>
<tr>
<td>change_voucher_amount</td>
<td>decimal</td>
<td>Change voucher amount</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Transaction description</td>
</tr>
<tr>
<td>member_description</td>
<td>string</td>
<td>Your personal note for this transaction</td>
</tr>
<tr>
<td>sender</td>
<td>string</td>
<td>Sender information</td>
</tr>
<tr>
<td>receiver</td>
<td>string</td>
<td>Receiver information</td>
</tr>
<tr>
<td>state</td>
<td>string</td>
<td>Transaction state</td>
</tr>
<tr>
<td>address</td>
<td>string</td>
<td>Blockchain address (for crypto transactions)</td>
</tr>
<tr>
<td>txid</td>
<td>string</td>
<td>Transaction ID (blockchain txid or internal reference)</td>
</tr>
<tr>
<td>beneficiary_id</td>
<td>integer</td>
<td>Beneficiary ID (for withdrawals)</td>
</tr>
<tr>
<td>paid_at</td>
<td>string</td>
<td>Payment completion timestamp (ISO8601)</td>
</tr>
<tr>
<td>expires_at</td>
<td>string</td>
<td>Expiry timestamp (ISO8601, for vouchers)</td>
</tr>
<tr>
<td>created_at</td>
<td>string</td>
<td>Transaction creation timestamp (ISO8601)</td>
</tr>
<tr>
<td>updated_at</td>
<td>string</td>
<td>Last update timestamp (ISO8601)</td>
</tr>
</tbody></table>
<h3 id='vasp'>VASP</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>integer</td>
<td>Unique VASP identifier (use for vasp_id)</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>VASP name</td>
</tr>
<tr>
<td>url</td>
<td>string</td>
<td>VASP website URL</td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td>VASP contact email</td>
</tr>
<tr>
<td>state</td>
<td>string</td>
<td>VASP state (active, pending, rejected, requested)</td>
</tr>
<tr>
<td>icon_url</td>
<td>string</td>
<td>VASP icon/logo URL</td>
</tr>
<tr>
<td>created_at</td>
<td>string</td>
<td>ISO8601 timestamp of VASP registration</td>
</tr>
</tbody></table>
<h3 id='paymentreference'>PaymentReference</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>integer</td>
<td>Payment reference ID</td>
</tr>
<tr>
<td>reference</td>
<td>string</td>
<td>Unique payment reference code (used by customer for deposits)</td>
</tr>
<tr>
<td>uid</td>
<td>string</td>
<td>Customer sub-account UID</td>
</tr>
<tr>
<td>currency</td>
<td>string</td>
<td>Currency code (e.g., &quot;btc&quot;, &quot;zar&quot;)</td>
</tr>
<tr>
<td>expected_amount</td>
<td>string</td>
<td>Expected deposit amount (null if not specified)</td>
</tr>
<tr>
<td>deposit_action</td>
<td>object</td>
<td>Automated action configuration (null if not configured)</td>
</tr>
<tr>
<td>state</td>
<td>string</td>
<td>Current state (see PaymentReference States)</td>
</tr>
<tr>
<td>expires_at</td>
<td>string</td>
<td>ISO8601 expiration timestamp</td>
</tr>
<tr>
<td>usage_count</td>
<td>integer</td>
<td>Number of times the reference has been used</td>
</tr>
<tr>
<td>last_used_at</td>
<td>string</td>
<td>ISO8601 timestamp of last use (null if never used)</td>
</tr>
<tr>
<td>webhook_url</td>
<td>string</td>
<td>Webhook URL (only included if configured)</td>
</tr>
<tr>
<td>webhook_protocol</td>
<td>string</td>
<td>Webhook protocol: &quot;hmac&quot;, &quot;plain_text&quot;, or &quot;none&quot; (only if configured)</td>
</tr>
<tr>
<td>webhook_secret</td>
<td>string</td>
<td>Webhook secret (only included for owner with includeSecret option)</td>
</tr>
<tr>
<td>deposit_id</td>
<td>integer</td>
<td>Linked deposit ID (only included if linked)</td>
</tr>
<tr>
<td>order_id</td>
<td>integer</td>
<td>Linked order ID (only included if linked)</td>
</tr>
<tr>
<td>withdraw_id</td>
<td>integer</td>
<td>Linked withdrawal ID (only included if linked)</td>
</tr>
<tr>
<td>internal_transfer_id</td>
<td>integer</td>
<td>Linked internal transfer ID (only included if linked)</td>
</tr>
<tr>
<td>error</td>
<td>string</td>
<td>Error message (only included if state is &quot;failed&quot;)</td>
</tr>
<tr>
<td>created_at</td>
<td>string</td>
<td>ISO8601 creation timestamp</td>
</tr>
<tr>
<td>updated_at</td>
<td>string</td>
<td>ISO8601 last update timestamp</td>
</tr>
</tbody></table>

<p><strong>Deposit Action Object Structure:</strong></p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>action</td>
<td>string</td>
<td>Action type: &quot;none&quot;, &quot;aggregate&quot;, &quot;convert_and_withdraw&quot;, &quot;aggregate_convert_and_withdraw&quot;</td>
</tr>
<tr>
<td>target_currency</td>
<td>string</td>
<td>Target currency for conversion (only for convert actions)</td>
</tr>
<tr>
<td>beneficiary_id</td>
<td>integer</td>
<td>Beneficiary ID for withdrawals (only for withdraw actions)</td>
</tr>
<tr>
<td>lightning_invoice</td>
<td>string</td>
<td>Lightning invoice for lightning withdrawals (alternative to beneficiary_id)</td>
</tr>
<tr>
<td>max_slippage</td>
<td>number</td>
<td>Maximum slippage percentage (0.1-10, default: 2.0)</td>
</tr>
</tbody></table>

<p><strong>PaymentReference States:</strong></p>

<p>Payment references progress through various states based on the configured actions. Webhook notifications are sent when the reference reaches <code>completed</code> or <code>failed</code> state.</p>

<table><thead>
<tr>
<th>State</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>pending_deposit</td>
<td>Waiting for deposit</td>
</tr>
<tr>
<td>pending_internal_transfer</td>
<td>Processing aggregation</td>
</tr>
<tr>
<td>pending_buy_order</td>
<td>Processing conversion (buy)</td>
</tr>
<tr>
<td>pending_sell_order</td>
<td>Processing conversion (sell)</td>
</tr>
<tr>
<td>pending_withdraw</td>
<td>Processing withdrawal</td>
</tr>
<tr>
<td>completed</td>
<td>All actions completed successfully</td>
</tr>
<tr>
<td>failed</td>
<td>Processing failed (see error field)</td>
</tr>
</tbody></table>
<h3 id='account-2'>Account</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>currency</td>
<td>string</td>
<td>Currency code.</td>
</tr>
<tr>
<td>balance</td>
<td>double</td>
<td>Account balance.</td>
</tr>
<tr>
<td>locked</td>
<td>double</td>
<td>Account locked funds.</td>
</tr>
</tbody></table>
<h3 id='deposit-method'>Deposit Method</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>uuid</td>
<td>string</td>
<td>Unique identifier for the deposit method</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Display name of the deposit method</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Human-readable description of the method</td>
</tr>
<tr>
<td>currencyId</td>
<td>string</td>
<td>Currency identifier (e.g., &quot;btc&quot;, &quot;zar&quot;)</td>
</tr>
<tr>
<td>symbol</td>
<td>string</td>
<td>Currency symbol (e.g., &quot;BTC&quot;, &quot;ZAR&quot;)</td>
</tr>
<tr>
<td>blockchainName</td>
<td>string</td>
<td>Blockchain network name (e.g., &quot;bitcoin&quot;, &quot;ethereum&quot;, &quot;fiat&quot;)</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>Method type (e.g., &quot;bank&quot;, &quot;crypto&quot;, &quot;voucher&quot;)</td>
</tr>
<tr>
<td>currencyType</td>
<td>string</td>
<td>Currency type: &quot;fiat&quot; or &quot;crypto&quot;</td>
</tr>
<tr>
<td>providerId</td>
<td>string</td>
<td>Payment provider identifier (e.g., &quot;stitch&quot;, &quot;xago&quot;, &quot;cape&quot;)</td>
</tr>
<tr>
<td>minAmount</td>
<td>number</td>
<td>Minimum deposit amount (after baseFactor conversion)</td>
</tr>
<tr>
<td>maxAmount</td>
<td>number</td>
<td>Maximum deposit amount (derived from remaining limits)</td>
</tr>
<tr>
<td>baseFactor</td>
<td>number</td>
<td>Conversion factor (divide stored amounts by this for display)</td>
</tr>
<tr>
<td>precision</td>
<td>number</td>
<td>Decimal precision for display</td>
</tr>
<tr>
<td>feeCape</td>
<td>number</td>
<td>Cape&#39;s fee amount or percentage</td>
</tr>
<tr>
<td>feeProvider</td>
<td>number</td>
<td>Provider&#39;s fee amount or percentage</td>
</tr>
<tr>
<td>position</td>
<td>number</td>
<td>Display order position</td>
</tr>
<tr>
<td>iconUrl</td>
<td>string</td>
<td>Icon URL for UI display</td>
</tr>
<tr>
<td>verified</td>
<td>boolean</td>
<td>Whether user is verified for this method</td>
</tr>
<tr>
<td>remainingLimits</td>
<td>object</td>
<td>Remaining transaction limits (see Remaining Limits object below)</td>
</tr>
</tbody></table>
<h3 id='withdraw-method'>Withdraw Method</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>uuid</td>
<td>string</td>
<td>Unique identifier for the withdraw method</td>
</tr>
<tr>
<td>id</td>
<td>number</td>
<td>Database ID (included for legacy support)</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Display name of the withdraw method</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Human-readable description of the method</td>
</tr>
<tr>
<td>currencyId</td>
<td>string</td>
<td>Currency identifier (e.g., &quot;btc&quot;, &quot;zar&quot;)</td>
</tr>
<tr>
<td>symbol</td>
<td>string</td>
<td>Currency symbol (e.g., &quot;BTC&quot;, &quot;ZAR&quot;)</td>
</tr>
<tr>
<td>blockchainName</td>
<td>string</td>
<td>Blockchain network name (e.g., &quot;bitcoin&quot;, &quot;ethereum&quot;, &quot;fiat&quot;)</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>Method type (e.g., &quot;crypto&quot;, &quot;bank&quot;, &quot;wallet&quot;)</td>
</tr>
<tr>
<td>currencyType</td>
<td>string</td>
<td>Currency type: &quot;fiat&quot; or &quot;crypto&quot;</td>
</tr>
<tr>
<td>providerId</td>
<td>string</td>
<td>Payment provider identifier (e.g., &quot;xago&quot;, &quot;celbux&quot;, &quot;cape&quot;)</td>
</tr>
<tr>
<td>processorId</td>
<td>string</td>
<td>Processor that handles withdrawals for this method</td>
</tr>
<tr>
<td>minAmount</td>
<td>number</td>
<td>Minimum withdrawal amount (after baseFactor conversion)</td>
</tr>
<tr>
<td>maxAmount</td>
<td>number</td>
<td>Maximum withdrawal amount (derived from remaining limits)</td>
</tr>
<tr>
<td>baseFactor</td>
<td>number</td>
<td>Conversion factor (divide stored amounts by this for display)</td>
</tr>
<tr>
<td>precision</td>
<td>number</td>
<td>Decimal precision for display</td>
</tr>
<tr>
<td>feeCape</td>
<td>number</td>
<td>Cape&#39;s withdrawal fee amount or percentage</td>
</tr>
<tr>
<td>feeProvider</td>
<td>number</td>
<td>Provider&#39;s withdrawal fee amount or percentage</td>
</tr>
<tr>
<td>position</td>
<td>number</td>
<td>Display order position</td>
</tr>
<tr>
<td>iconUrl</td>
<td>string</td>
<td>Icon URL for UI display</td>
</tr>
<tr>
<td>verified</td>
<td>boolean</td>
<td>Whether user is verified for this method</td>
</tr>
<tr>
<td>remainingLimits</td>
<td>object</td>
<td>Remaining transaction limits (see Remaining Limits object below)</td>
</tr>
</tbody></table>
<h3 id='remaining-limits'>Remaining Limits</h3>
<p>The <code>remainingLimits</code> object is included in both Deposit Method and Withdraw Method responses.</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>transaction_max</td>
<td>number</td>
<td>Maximum amount allowed per single transaction</td>
</tr>
<tr>
<td>day</td>
<td>number</td>
<td>Remaining limit for the current day</td>
</tr>
<tr>
<td>week</td>
<td>number</td>
<td>Remaining limit for the current week</td>
</tr>
<tr>
<td>month</td>
<td>number</td>
<td>Remaining limit for the current month</td>
</tr>
<tr>
<td>year_to_date</td>
<td>number</td>
<td>Remaining limit for the current year</td>
</tr>
</tbody></table>
<h3 id='voucher-redemption'>Voucher Redemption</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>amount</td>
<td>number</td>
<td>The amount deposited after fees.</td>
</tr>
<tr>
<td>origin_amount</td>
<td>number</td>
<td>The original amount of the voucher.</td>
</tr>
<tr>
<td>change_voucher</td>
<td><a href="#change-voucher">Change voucher</a></td>
<td>Optional if provider offers this, a new voucher for the remaining amount</td>
</tr>
</tbody></table>
<h3 id='change-voucher'>Change voucher</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>change_amount</td>
<td>number</td>
<td>Amount of change from the redeemed voucher, available to be spent</td>
</tr>
<tr>
<td>change_expiry</td>
<td>string</td>
<td>Expiry date of the new voucher.</td>
</tr>
<tr>
<td>change_pin</td>
<td>number</td>
<td>The new voucher_pin to be used for redemption.</td>
</tr>
</tbody></table>
<h3 id='lightning-payment'>Lightning payment</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>bolt</td>
<td>String</td>
<td>The invoice bolt11.</td>
</tr>
<tr>
<td>address</td>
<td>String</td>
<td>The address of the invoice if not bolt11.</td>
</tr>
<tr>
<td>amount</td>
<td>number</td>
<td>Invoice amount paid in SAT.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Description for this invoice in the bolt11.</td>
</tr>
<tr>
<td>member_description</td>
<td>String</td>
<td>Private member description for this invoice provided by member.</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>Payment state.</td>
</tr>
<tr>
<td>created_at</td>
<td>String (ISO8601 formatted)</td>
<td>The datetime when payment was created.</td>
</tr>
</tbody></table>
<h3 id='lightning-invoice'>Lightning invoice</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>bolt</td>
<td>String</td>
<td>The invoice in bolt11.</td>
</tr>
<tr>
<td>amount</td>
<td>BigDecimal</td>
<td>Invoice amount to be paid in SAT.</td>
</tr>
<tr>
<td>conversion_percent</td>
<td>BigDecimal</td>
<td>The amount to automatically convert to FIAT.</td>
</tr>
<tr>
<td>amount_msat</td>
<td>BigDecimal</td>
<td>Invoice amount to be paid in Mili SAT.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Description for this invoice.</td>
</tr>
<tr>
<td>member_description</td>
<td>String</td>
<td>Private member Description for this invoice.</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>Payment state.</td>
</tr>
<tr>
<td>created_at</td>
<td>String (ISO8601 formatted)</td>
<td>The datetime when invoice was created.</td>
</tr>
<tr>
<td>expires_at</td>
<td>String (ISO8601 formatted)</td>
<td>The datetime when invoice expires.</td>
</tr>
<tr>
<td>paid_at</td>
<td>String (ISO8601 formatted)</td>
<td>The datetime when invoice was paid.</td>
</tr>
</tbody></table>
<h3 id='websocket-orderbook-snapshot'>Websocket orderbook snapshot</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>{market}.ob-snap</td>
<td>Object</td>
<td>The object key for the subscription</td>
</tr>
<tr>
<td>asks</td>
<td>[<a href="#orderbook-entry">Orderbook entry</a>]</td>
<td>Array of ask / sell orderbook entries.</td>
</tr>
<tr>
<td>bids</td>
<td>[<a href="#orderbook-entry">Orderbook entry</a>]</td>
<td>Array of bid / buy orderbook entries.</td>
</tr>
<tr>
<td>sequence</td>
<td>integer</td>
<td>The current sequence of the orderbook, used to ensure updates are sequential</td>
</tr>
</tbody></table>
<h3 id='websocket-orderbook-increment'>Websocket orderbook increment</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>{market}.ob-inc</td>
<td>Object</td>
<td>The object key for the subscription</td>
</tr>
<tr>
<td>asks</td>
<td>[<a href="#orderbook-entry">Orderbook entry</a>]</td>
<td>Array of ask / sell orderbook entries.</td>
</tr>
<tr>
<td>bids</td>
<td>[<a href="#orderbook-entry">Orderbook entry</a>]</td>
<td>Array of bid / buy orderbook entries.</td>
</tr>
<tr>
<td>sequence</td>
<td>integer</td>
<td>The current sequence of the orderbook, used to ensure updates are sequential</td>
</tr>
</tbody></table>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"btczar.ob-snap"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"asks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">[</span><span class="s2">"841039.73"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0.156431"</span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="s2">"845402.1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0.004389"</span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="s2">"900000.0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0.00001"</span><span class="p">]</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"bids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">[</span><span class="s2">"835956.8"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0.047756"</span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="s2">"831012.48"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0.03749"</span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="s2">"829990.51"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0.019462"</span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="s2">"400000.0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0.0001"</span><span class="p">]</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"sequence"</span><span class="p">:</span><span class="w"> </span><span class="mi">9712</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='states'>States</h3>
<table><thead>
<tr>
<th>Order states</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>pending</td>
<td>Initial state - order has been submitted (but is not yet placed / confirmed)</td>
</tr>
<tr>
<td>wait</td>
<td>Order has been placed and is available on the orderbook</td>
</tr>
<tr>
<td>done</td>
<td>Order has been completely filled</td>
</tr>
<tr>
<td>cancel</td>
<td>The order has been cancelled (A cancelled limit order may still have executed trades against it)</td>
</tr>
<tr>
<td>reject</td>
<td>The order submission was rejected</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Deposit states</th>
</tr>
</thead><tbody>
<tr>
<td>submitted</td>
</tr>
<tr>
<td>canceled</td>
</tr>
<tr>
<td>rejected</td>
</tr>
<tr>
<td>accepted</td>
</tr>
<tr>
<td>collected</td>
</tr>
<tr>
<td>skipped</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Withdraw states</th>
</tr>
</thead><tbody>
<tr>
<td>prepared</td>
</tr>
<tr>
<td>submitted</td>
</tr>
<tr>
<td>rejected</td>
</tr>
<tr>
<td>accepted</td>
</tr>
<tr>
<td>skipped</td>
</tr>
<tr>
<td>processing</td>
</tr>
<tr>
<td>succeed</td>
</tr>
<tr>
<td>canceled</td>
</tr>
<tr>
<td>failed</td>
</tr>
<tr>
<td>errored</td>
</tr>
<tr>
<td>confirming</td>
</tr>
</tbody></table>
<h1 id='errors'>Errors</h1>
<table><thead>
<tr>
<th>Code</th>
<th>Reason</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request</td>
<td>Your request is invalid.</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
<td>Apikey / secret / HMAC signature incorrect</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
<td>You are authenticated, but unauthorized to access this endpoint.</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
<td>Invalid endpoint.</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed</td>
<td>Invalid method for endpoint eg POST instead of GET.</td>
</tr>
<tr>
<td>422</td>
<td>Unprocessible Entity</td>
<td>The server understood the request, but the data provided is incorrect.</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests</td>
<td>You&#39;re sending too many requests too quickly. Slow down!</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error</td>
<td>We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable</td>
<td>We&#39;re temporarily offline for maintenance. Please try again later.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
